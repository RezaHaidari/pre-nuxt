{"version":3,"file":"nuxt.js","sources":["../lib/common/utils.js","../lib/common/options.js","../lib/core/module.js","../lib/core/meta.js","../lib/core/renderer.js","../lib/core/nuxt.js","../lib/builder/webpack/timefix-plugin.js","../lib/builder/webpack/base.config.js","../lib/builder/webpack/client.config.js","../lib/builder/webpack/server.config.js","../lib/builder/webpack/dll.config.js","../lib/builder/webpack/vue-loader.config.js","../lib/builder/webpack/style-loader.js","../lib/builder/builder.js","../lib/builder/generator.js","../lib/index.js"],"sourcesContent":["import { resolve, relative, sep } from 'path'\r\nimport _ from 'lodash'\r\n\r\nexport function encodeHtml(str) {\r\n  return str.replace(/</g, '&lt;').replace(/>/g, '&gt;')\r\n}\r\n\r\nexport function getContext(req, res) {\r\n  return { req, res }\r\n}\r\n\r\nexport function setAnsiColors(ansiHTML) {\r\n  ansiHTML.setColors({\r\n    reset: ['efefef', 'a6004c'],\r\n    darkgrey: '5a012b',\r\n    yellow: 'ffab07',\r\n    green: 'aeefba',\r\n    magenta: 'ff84bf',\r\n    blue: '3505a0',\r\n    cyan: '56eaec',\r\n    red: '4e053a'\r\n  })\r\n}\r\n\r\nexport async function waitFor(ms) {\r\n  return new Promise(resolve => setTimeout(resolve, (ms || 0)))\r\n}\r\n\r\nexport function urlJoin() {\r\n  return [].slice.call(arguments).join('/').replace(/\\/+/g, '/').replace(':/', '://')\r\n}\r\n\r\nexport function isUrl(url) {\r\n  return (url.indexOf('http') === 0 || url.indexOf('//') === 0)\r\n}\r\n\r\nexport function promisifyRoute(fn) {\r\n  // If routes is an array\r\n  if (Array.isArray(fn)) {\r\n    return Promise.resolve(fn)\r\n  }\r\n  // If routes is a function expecting a callback\r\n  if (fn.length === 1) {\r\n    return new Promise((resolve, reject) => {\r\n      fn(function (err, routeParams) {\r\n        if (err) {\r\n          reject(err)\r\n        }\r\n        resolve(routeParams)\r\n      })\r\n    })\r\n  }\r\n  let promise = fn()\r\n  if (!promise || (!(promise instanceof Promise) && (typeof promise.then !== 'function'))) {\r\n    promise = Promise.resolve(promise)\r\n  }\r\n  return promise\r\n}\r\n\r\nexport function sequence(tasks, fn) {\r\n  return tasks.reduce((promise, task) => promise.then(() => fn(task)), Promise.resolve())\r\n}\r\n\r\nexport function parallel(tasks, fn) {\r\n  return Promise.all(tasks.map(task => fn(task)))\r\n}\r\n\r\nexport function chainFn(base, fn) {\r\n  /* istanbul ignore if */\r\n  if (!(fn instanceof Function)) {\r\n    return\r\n  }\r\n  return function () {\r\n    if (typeof base !== 'function') {\r\n      return fn.apply(this, arguments)\r\n    }\r\n    let baseResult = base.apply(this, arguments)\r\n    // Allow function to mutate the first argument instead of returning the result\r\n    if (baseResult === undefined) {\r\n      baseResult = arguments[0]\r\n    }\r\n    let fnResult = fn.call(this, baseResult, ...Array.prototype.slice.call(arguments, 1))\r\n    // Return mutated argument if no result was returned\r\n    if (fnResult === undefined) {\r\n      return baseResult\r\n    }\r\n    return fnResult\r\n  }\r\n}\r\n\r\nexport function isPureObject(o) {\r\n  return !Array.isArray(o) && typeof o === 'object'\r\n}\r\n\r\nexport const isWindows = /^win/.test(process.platform)\r\n\r\nexport function wp(p = '') {\r\n  /* istanbul ignore if */\r\n  if (isWindows) {\r\n    return p.replace(/\\\\/g, '\\\\\\\\')\r\n  }\r\n  return p\r\n}\r\n\r\nexport function wChunk(p = '') {\r\n  /* istanbul ignore if */\r\n  if (isWindows) {\r\n    return p.replace(/\\//g, '_')\r\n  }\r\n  return p\r\n}\r\n\r\nconst reqSep = /\\//g\r\nconst sysSep = _.escapeRegExp(sep)\r\nconst normalize = string => string.replace(reqSep, sysSep)\r\n\r\nexport function r() {\r\n  let args = Array.prototype.slice.apply(arguments)\r\n  let lastArg = _.last(args)\r\n\r\n  if (lastArg.includes('@') || lastArg.includes('~')) {\r\n    return wp(lastArg)\r\n  }\r\n\r\n  return wp(resolve(...args.map(normalize)))\r\n}\r\n\r\nexport function relativeTo() {\r\n  let args = Array.prototype.slice.apply(arguments)\r\n  let dir = args.shift()\r\n\r\n  // Resolve path\r\n  let path = r(...args)\r\n\r\n  // Check if path is an alias\r\n  if (path.includes('@') || path.includes('~')) {\r\n    return path\r\n  }\r\n\r\n  // Make correct relative path\r\n  let rp = relative(dir, path)\r\n  if (rp[0] !== '.') {\r\n    rp = './' + rp\r\n  }\r\n  return wp(rp)\r\n}\r\n\r\nexport function flatRoutes(router, path = '', routes = []) {\r\n  router.forEach((r) => {\r\n    if (!r.path.includes(':') && !r.path.includes('*')) {\r\n      /* istanbul ignore if */\r\n      if (r.children) {\r\n        flatRoutes(r.children, path + r.path + '/', routes)\r\n      } else {\r\n        routes.push((r.path === '' && path[path.length - 1] === '/' ? path.slice(0, -1) : path) + r.path)\r\n      }\r\n    }\r\n  })\r\n  return routes\r\n}\r\n\r\nexport function cleanChildrenRoutes(routes, isChild = false) {\r\n  let start = -1\r\n  let routesIndex = []\r\n  routes.forEach((route) => {\r\n    if (/-index$/.test(route.name) || route.name === 'index') {\r\n      // Save indexOf 'index' key in name\r\n      let res = route.name.split('-')\r\n      let s = res.indexOf('index')\r\n      start = (start === -1 || s < start) ? s : start\r\n      routesIndex.push(res)\r\n    }\r\n  })\r\n  routes.forEach((route) => {\r\n    route.path = (isChild) ? route.path.replace('/', '') : route.path\r\n    if (route.path.indexOf('?') > -1) {\r\n      let names = route.name.split('-')\r\n      let paths = route.path.split('/')\r\n      if (!isChild) {\r\n        paths.shift()\r\n      } // clean first / for parents\r\n      routesIndex.forEach((r) => {\r\n        let i = r.indexOf('index') - start //  children names\r\n        if (i < paths.length) {\r\n          for (let a = 0; a <= i; a++) {\r\n            if (a === i) {\r\n              paths[a] = paths[a].replace('?', '')\r\n            }\r\n            if (a < i && names[a] !== r[a]) {\r\n              break\r\n            }\r\n          }\r\n        }\r\n      })\r\n      route.path = (isChild ? '' : '/') + paths.join('/')\r\n    }\r\n    route.name = route.name.replace(/-index$/, '')\r\n    if (route.children) {\r\n      if (route.children.find((child) => child.path === '')) {\r\n        delete route.name\r\n      }\r\n      route.children = cleanChildrenRoutes(route.children, true)\r\n    }\r\n  })\r\n  return routes\r\n}\r\n\r\nexport function createRoutes(files, srcDir) {\r\n  let routes = []\r\n  files.forEach((file) => {\r\n    let keys = file.replace(/^pages/, '').replace(/\\.vue$/, '').replace(/\\/{2,}/g, '/').split('/').slice(1)\r\n    let route = { name: '', path: '', component: r(srcDir, file) }\r\n    let parent = routes\r\n    keys.forEach((key, i) => {\r\n      route.name = route.name ? route.name + '-' + key.replace('_', '') : key.replace('_', '')\r\n      route.name += (key === '_') ? 'all' : ''\r\n      route.chunkName = file.replace(/\\.vue$/, '')\r\n      let child = _.find(parent, { name: route.name })\r\n      if (child) {\r\n        child.children = child.children || []\r\n        parent = child.children\r\n        route.path = ''\r\n      } else {\r\n        if (key === 'index' && (i + 1) === keys.length) {\r\n          route.path += (i > 0 ? '' : '/')\r\n        } else {\r\n          route.path += '/' + (key === '_' ? '*' : key.replace('_', ':'))\r\n          if (key !== '_' && key.indexOf('_') !== -1) {\r\n            route.path += '?'\r\n          }\r\n        }\r\n      }\r\n    })\r\n    // Order Routes path\r\n    parent.push(route)\r\n    parent.sort((a, b) => {\r\n      if (!a.path.length || a.path === '/') {\r\n        return -1\r\n      }\r\n      if (!b.path.length || b.path === '/') {\r\n        return 1\r\n      }\r\n      let i = 0\r\n      let res = 0\r\n      let y = 0\r\n      let z = 0\r\n      const _a = a.path.split('/')\r\n      const _b = b.path.split('/')\r\n      for (i = 0; i < _a.length; i++) {\r\n        if (res !== 0) {\r\n          break\r\n        }\r\n        y = _a[i] === '*' ? 2 : (_a[i].indexOf(':') > -1 ? 1 : 0)\r\n        z = _b[i] === '*' ? 2 : (_b[i].indexOf(':') > -1 ? 1 : 0)\r\n        res = y - z\r\n        // If a.length >= b.length\r\n        if (i === _b.length - 1 && res === 0) {\r\n          // change order if * found\r\n          res = _a[i] === '*' ? -1 : 1\r\n        }\r\n      }\r\n      return res === 0 ? (_a[i - 1] === '*' && _b[i] ? 1 : -1) : res\r\n    })\r\n  })\r\n  return cleanChildrenRoutes(routes)\r\n}\r\n","import _ from 'lodash'\r\nimport Debug from 'debug'\r\nimport { join, resolve } from 'path'\r\nimport { existsSync } from 'fs'\r\nimport { isUrl, isPureObject } from 'utils'\r\n\r\nconst debug = Debug('nuxt:build')\r\ndebug.color = 2 // Force green color\r\n\r\nconst Options = {}\r\n\r\nexport default Options\r\n\r\nOptions.from = function (_options) {\r\n  // Clone options to prevent unwanted side-effects\r\n  const options = Object.assign({}, _options)\r\n\r\n  // Normalize options\r\n  if (options.loading === true) {\r\n    delete options.loading\r\n  }\r\n  if (options.router && options.router.middleware && !Array.isArray(options.router.middleware)) {\r\n    options.router.middleware = [options.router.middleware]\r\n  }\r\n  if (options.router && typeof options.router.base === 'string') {\r\n    options._routerBaseSpecified = true\r\n  }\r\n  if (typeof options.transition === 'string') {\r\n    options.transition = { name: options.transition }\r\n  }\r\n  if (typeof options.layoutTransition === 'string') {\r\n    options.layoutTransition = { name: options.layoutTransition }\r\n  }\r\n\r\n  // Apply defaults\r\n  _.defaultsDeep(options, Options.defaults)\r\n\r\n  // Resolve dirs\r\n  const hasValue = v => typeof v === 'string' && v\r\n  options.rootDir = hasValue(options.rootDir) ? options.rootDir : process.cwd()\r\n  options.srcDir = hasValue(options.srcDir) ? resolve(options.rootDir, options.srcDir) : options.rootDir\r\n  options.buildDir = resolve(options.rootDir, options.buildDir)\r\n  options.cacheDir = resolve(options.rootDir, options.cacheDir)\r\n\r\n  // Normalize modulesDir\r\n  if (!Array.isArray(options.modulesDir)) {\r\n    options.modulesDir = [options.modulesDir]\r\n  }\r\n  /* istanbul ignore if */\r\n  if (!options.modulesDir.length) {\r\n    options.modulesDir = ['node_modules']\r\n  }\r\n  options.modulesDir = options.modulesDir.filter(dir => hasValue(dir)).map(dir => resolve(options.rootDir, dir))\r\n\r\n  // If app.html is defined, set the template path to the user template\r\n  options.appTemplatePath = resolve(options.buildDir, 'views/app.template.html')\r\n  if (existsSync(join(options.srcDir, 'app.html'))) {\r\n    options.appTemplatePath = join(options.srcDir, 'app.html')\r\n  }\r\n\r\n  // Ignore publicPath on dev\r\n  /* istanbul ignore if */\r\n  if (options.dev && isUrl(options.build.publicPath)) {\r\n    options.build.publicPath = Options.defaults.build.publicPath\r\n  }\r\n\r\n  // If store defined, update store options to true unless explicitly disabled\r\n  if (options.store !== false && existsSync(join(options.srcDir, 'store'))) {\r\n    options.store = true\r\n  }\r\n\r\n  // Normalize loadingIndicator\r\n  if (!isPureObject(options.loadingIndicator)) {\r\n    options.loadingIndicator = { name: options.loadingIndicator }\r\n  }\r\n\r\n  // Apply defaults to loadingIndicator\r\n  options.loadingIndicator = Object.assign({\r\n    name: 'pulse',\r\n    color: '#dbe1ec',\r\n    background: 'white'\r\n  }, options.loadingIndicator)\r\n\r\n  // cssSourceMap\r\n  if (options.build.cssSourceMap === undefined) {\r\n    options.build.cssSourceMap = options.dev\r\n  }\r\n\r\n  // Postcss\r\n  // 1. Check if it is explicitly disabled by false value\r\n  // ... Disable all postcss loaders\r\n  // 2. Check if any standard source of postcss config exists\r\n  // ... Make postcss = { config: { path } }\r\n  // 3. Else (Easy Usage)\r\n  // ... Auto merge it with defaults\r\n  if (options.build.postcss !== false) {\r\n    // Detect postcss config existence\r\n    // https://github.com/michael-ciniawsky/postcss-load-config\r\n    let postcssConfigPath\r\n    for (let dir of [options.srcDir, options.rootDir]) {\r\n      for (let file of ['postcss.config.js', '.postcssrc.js', '.postcssrc', '.postcssrc.json', '.postcssrc.yaml']) {\r\n        if (existsSync(resolve(dir, file))) {\r\n          postcssConfigPath = resolve(dir, file)\r\n          break\r\n        }\r\n      }\r\n      if (postcssConfigPath) break\r\n    }\r\n\r\n    // Default postcss options\r\n    if (postcssConfigPath) {\r\n      debug(`Using PostCSS config file: ${postcssConfigPath}`)\r\n      options.build.postcss = {\r\n        sourceMap: options.build.cssSourceMap,\r\n        // https://github.com/postcss/postcss-loader/blob/master/lib/index.js#L79\r\n        config: {\r\n          path: postcssConfigPath\r\n        }\r\n      }\r\n    } else {\r\n      if (Object.keys(options.build.postcss).length) {\r\n        debug('Using PostCSS config from `build.postcss`')\r\n      }\r\n      // Normalize & Apply default plugins\r\n      if (Array.isArray(options.build.postcss)) {\r\n        options.build.postcss = { plugins: options.build.postcss }\r\n      }\r\n      if (isPureObject(options.build.postcss)) {\r\n        options.build.postcss = Object.assign({\r\n          sourceMap: options.build.cssSourceMap,\r\n          plugins: {\r\n            // https://github.com/postcss/postcss-import\r\n            'postcss-import': {\r\n              root: options.rootDir,\r\n              path: [\r\n                options.srcDir,\r\n                options.rootDir,\r\n                ...options.modulesDir\r\n              ]\r\n            },\r\n            // https://github.com/postcss/postcss-url\r\n            'postcss-url': {},\r\n            // http://cssnext.io/postcss\r\n            'postcss-cssnext': {}\r\n          }\r\n        }, options.build.postcss)\r\n      }\r\n    }\r\n  }\r\n\r\n  // Debug errors\r\n  if (options.debug === undefined) {\r\n    options.debug = options.dev\r\n  }\r\n\r\n  // Apply mode preset\r\n  let modePreset = Options.modes[options.mode || 'universal'] || Options.modes['universal']\r\n  _.defaultsDeep(options, modePreset)\r\n\r\n  // If no server-side rendering, add appear true transition\r\n  /* istanbul ignore if */\r\n  if (options.render.ssr === false && options.transition) {\r\n    options.transition.appear = true\r\n  }\r\n\r\n  return options\r\n}\r\n\r\nOptions.modes = {\r\n  universal: {\r\n    build: {\r\n      ssr: true\r\n    },\r\n    render: {\r\n      ssr: true\r\n    }\r\n  },\r\n  spa: {\r\n    build: {\r\n      ssr: false\r\n    },\r\n    render: {\r\n      ssr: false\r\n    }\r\n  }\r\n}\r\n\r\nOptions.defaults = {\r\n  mode: 'universal',\r\n  dev: process.env.NODE_ENV !== 'production',\r\n  debug: undefined, // Will be equal to dev if not provided\r\n  buildDir: '.nuxt',\r\n  cacheDir: '.cache',\r\n  nuxtDir: resolve(__dirname, '..'), // Relative to dist\r\n  nuxtAppDir: resolve(__dirname, '../lib/app/'), // Relative to dist\r\n  build: {\r\n    analyze: false,\r\n    dll: false,\r\n    scopeHoisting: false,\r\n    extractCSS: false,\r\n    cssSourceMap: undefined,\r\n    ssr: undefined,\r\n    uglify: {},\r\n    publicPath: '/_nuxt/',\r\n    filenames: {\r\n      css: 'vendor.[contenthash].css',\r\n      manifest: 'manifest.[hash].js',\r\n      vendor: 'vendor.[chunkhash].js',\r\n      app: 'app.[chunkhash].js',\r\n      chunk: '[name].[chunkhash].js'\r\n    },\r\n    vendor: [],\r\n    plugins: [],\r\n    babel: {},\r\n    postcss: {},\r\n    templates: [],\r\n    watch: [],\r\n    devMiddleware: {},\r\n    hotMiddleware: {}\r\n  },\r\n  generate: {\r\n    dir: 'dist',\r\n    routes: [],\r\n    concurrency: 500,\r\n    interval: 0,\r\n    subFolders: true,\r\n    minify: {\r\n      collapseBooleanAttributes: true,\r\n      collapseWhitespace: false,\r\n      decodeEntities: true,\r\n      minifyCSS: true,\r\n      minifyJS: true,\r\n      processConditionalComments: true,\r\n      removeAttributeQuotes: false,\r\n      removeComments: false,\r\n      removeEmptyAttributes: true,\r\n      removeOptionalTags: true,\r\n      removeRedundantAttributes: true,\r\n      removeScriptTypeAttributes: false,\r\n      removeStyleLinkTypeAttributes: false,\r\n      removeTagWhitespace: false,\r\n      sortAttributes: true,\r\n      sortClassName: false,\r\n      trimCustomFragments: true,\r\n      useShortDoctype: true\r\n    }\r\n  },\r\n  env: {},\r\n  head: {\r\n    meta: [],\r\n    link: [],\r\n    style: [],\r\n    script: []\r\n  },\r\n  plugins: [],\r\n  css: [],\r\n  modules: [],\r\n  layouts: {},\r\n  serverMiddleware: [],\r\n  ErrorPage: null,\r\n  loading: {\r\n    color: 'black',\r\n    failedColor: 'red',\r\n    height: '2px',\r\n    duration: 5000,\r\n    rtl: false\r\n  },\r\n  loadingIndicator: {},\r\n  transition: {\r\n    name: 'page',\r\n    mode: 'out-in',\r\n    appear: false,\r\n    appearClass: 'appear',\r\n    appearActiveClass: 'appear-active',\r\n    appearToClass: 'appear-to'\r\n  },\r\n  layoutTransition: {\r\n    name: 'layout',\r\n    mode: 'out-in'\r\n  },\r\n  router: {\r\n    mode: 'history',\r\n    base: '/',\r\n    routes: [],\r\n    middleware: [],\r\n    linkActiveClass: 'nuxt-link-active',\r\n    linkExactActiveClass: 'nuxt-link-exact-active',\r\n    extendRoutes: null,\r\n    scrollBehavior: null,\r\n    parseQuery: false,\r\n    stringifyQuery: false,\r\n    fallback: false\r\n  },\r\n  render: {\r\n    bundleRenderer: {},\r\n    resourceHints: true,\r\n    ssr: undefined,\r\n    http2: {\r\n      push: false\r\n    },\r\n    static: {},\r\n    gzip: {\r\n      threshold: 0\r\n    },\r\n    etag: {\r\n      weak: true // Faster for responses > 5KB\r\n    }\r\n  },\r\n  watchers: {\r\n    webpack: {\r\n      ignored: /-dll/\r\n    },\r\n    chokidar: {}\r\n  },\r\n  editor: {\r\n    editor: 'code'\r\n  },\r\n  hooks: null,\r\n  messages: {\r\n    error_404: 'This page could not be found',\r\n    server_error: 'Server error',\r\n    nuxtjs: 'Nuxt.js',\r\n    back_to_home: 'Back to the home page',\r\n    server_error_details: 'An error occurred in the application and your page could not be served. If you are the application owner, check your logs for details.',\r\n    client_error: 'Error',\r\n    client_error_details: 'An error occurred while rendering the page. Check developer tools console for details.'\r\n  }\r\n}\r\n","import path from 'path'\r\nimport fs from 'fs'\r\nimport { uniq } from 'lodash'\r\nimport hash from 'hash-sum'\r\nimport { chainFn, sequence } from 'utils'\r\nimport Debug from 'debug'\r\n\r\nconst debug = Debug('nuxt:module')\r\n\r\nexport default class ModuleContainer {\r\n  constructor(nuxt) {\r\n    this.nuxt = nuxt\r\n    this.options = nuxt.options\r\n    this.requiredModules = []\r\n  }\r\n\r\n  async ready() {\r\n    await this.nuxt.callHook('modules:before', this, this.options.modules)\r\n    // Load every module in sequence\r\n    await sequence(this.options.modules, this.addModule.bind(this))\r\n    // Call done hook\r\n    await this.nuxt.callHook('modules:done', this)\r\n  }\r\n\r\n  addVendor(vendor) {\r\n    /* istanbul ignore if */\r\n    if (!vendor) {\r\n      return\r\n    }\r\n    this.options.build.vendor = uniq(this.options.build.vendor.concat(vendor))\r\n  }\r\n\r\n  addTemplate(template) {\r\n    /* istanbul ignore if */\r\n    if (!template) {\r\n      return\r\n    }\r\n    // Validate & parse source\r\n    const src = template.src || template\r\n    const srcPath = path.parse(src)\r\n    /* istanbul ignore if */\r\n    if (!src || typeof src !== 'string' || !fs.existsSync(src)) {\r\n      /* istanbul ignore next */\r\n      debug('[nuxt] invalid template', template)\r\n      return\r\n    }\r\n    // Generate unique and human readable dst filename\r\n    const dst = template.fileName ||\r\n      (path.basename(srcPath.dir) + '.' + srcPath.name + '.' + hash(src) + srcPath.ext)\r\n    // Add to templates list\r\n    const templateObj = {\r\n      src,\r\n      dst,\r\n      options: template.options\r\n    }\r\n    this.options.build.templates.push(templateObj)\r\n    return templateObj\r\n  }\r\n\r\n  addPlugin(template) {\r\n    const { dst } = this.addTemplate(template)\r\n    // Add to nuxt plugins\r\n    this.options.plugins.unshift({\r\n      src: path.join(this.options.buildDir, dst),\r\n      ssr: template.ssr\r\n    })\r\n  }\r\n\r\n  addServerMiddleware(middleware) {\r\n    this.options.serverMiddleware.push(middleware)\r\n  }\r\n\r\n  extendBuild(fn) {\r\n    this.options.build.extend = chainFn(this.options.build.extend, fn)\r\n  }\r\n\r\n  extendRoutes(fn) {\r\n    this.options.router.extendRoutes = chainFn(this.options.router.extendRoutes, fn)\r\n  }\r\n\r\n  requireModule(moduleOpts) {\r\n    // Require once\r\n    return this.addModule(moduleOpts, true)\r\n  }\r\n\r\n  async addModule(moduleOpts, requireOnce) {\r\n    /* istanbul ignore if */\r\n    if (!moduleOpts) {\r\n      return\r\n    }\r\n\r\n    // Allow using babel style array options\r\n    if (Array.isArray(moduleOpts)) {\r\n      moduleOpts = {\r\n        src: moduleOpts[0],\r\n        options: moduleOpts[1]\r\n      }\r\n    }\r\n\r\n    // Allows passing runtime options to each module\r\n    const options = moduleOpts.options || (typeof moduleOpts === 'object' ? moduleOpts : {})\r\n    const src = moduleOpts.src || moduleOpts\r\n\r\n    // Resolve module\r\n    let module\r\n    if (typeof src === 'string') {\r\n      module = require(this.nuxt.resolvePath(src))\r\n    }\r\n\r\n    // Validate module\r\n    /* istanbul ignore if */\r\n    if (typeof module !== 'function') {\r\n      throw new Error(`[nuxt] Module ${JSON.stringify(src)} should export a function`)\r\n    }\r\n\r\n    // Module meta\r\n    module.meta = module.meta || {}\r\n    let name = module.meta.name || module.name\r\n\r\n    // If requireOnce specified & module from NPM or with specified name\r\n    if (requireOnce && name) {\r\n      const alreadyRequired = this.requiredModules.indexOf(name) !== -1\r\n      if (alreadyRequired) {\r\n        return\r\n      }\r\n      this.requiredModules.push(name)\r\n    }\r\n\r\n    // Call module with `this` context and pass options\r\n    await new Promise((resolve, reject) => {\r\n      const result = module.call(this, options, (err) => {\r\n        /* istanbul ignore if */\r\n        if (err) {\r\n          return reject(err)\r\n        }\r\n        resolve()\r\n      })\r\n      // If module send back a promise\r\n      if (result && result.then instanceof Function) {\r\n        return result.then(resolve)\r\n      }\r\n      // If not expecting a callback but returns no promise (=synchronous)\r\n      if (module.length < 2) {\r\n        return resolve()\r\n      }\r\n    })\r\n  }\r\n}\r\n","\r\nimport Vue from 'vue'\r\nimport VueMeta from 'vue-meta'\r\nimport VueServerRenderer from 'vue-server-renderer'\r\nimport LRU from 'lru-cache'\r\n\r\nexport default class MetaRenderer {\r\n  constructor(nuxt, renderer) {\r\n    this.nuxt = nuxt\r\n    this.renderer = renderer\r\n    this.options = nuxt.options\r\n    this.vueRenderer = VueServerRenderer.createRenderer()\r\n    this.cache = LRU({})\r\n\r\n    // Add VueMeta to Vue (this is only for SPA mode)\r\n    // See lib/app/index.js\r\n    Vue.use(VueMeta, {\r\n      keyName: 'head',\r\n      attribute: 'data-n-head',\r\n      ssrAttribute: 'data-n-head-ssr',\r\n      tagIDKeyName: 'hid'\r\n    })\r\n  }\r\n\r\n  async getMeta(url) {\r\n    const vm = new Vue({\r\n      render: h => h(), // Render empty html tag\r\n      head: this.options.head || {}\r\n    })\r\n    await this.vueRenderer.renderToString(vm)\r\n    return vm.$meta().inject()\r\n  }\r\n\r\n  async render({ url = '/' }) {\r\n    let meta = this.cache.get(url)\r\n\r\n    if (meta) {\r\n      return meta\r\n    }\r\n\r\n    meta = {\r\n      HTML_ATTRS: '',\r\n      BODY_ATTRS: '',\r\n      HEAD: '',\r\n      BODY_SCRIPTS: ''\r\n    }\r\n    // Get vue-meta context\r\n    const m = await this.getMeta(url)\r\n    // HTML_ATTRS\r\n    meta.HTML_ATTRS = m.htmlAttrs.text()\r\n    // BODY_ATTRS\r\n    meta.BODY_ATTRS = m.bodyAttrs.text()\r\n    // HEAD tags\r\n    meta.HEAD = m.meta.text() + m.title.text() + m.link.text() + m.style.text() + m.script.text() + m.noscript.text()\r\n    // BODY_SCRIPTS\r\n    meta.BODY_SCRIPTS = m.script.text({ body: true })\r\n    // Resources Hints\r\n    meta.resourceHints = ''\r\n    // Resource Hints\r\n    const clientManifest = this.renderer.resources.clientManifest\r\n    if (this.options.render.resourceHints && clientManifest) {\r\n      const publicPath = clientManifest.publicPath || '/_nuxt/'\r\n      // Pre-Load initial resources\r\n      if (Array.isArray(clientManifest.initial)) {\r\n        meta.resourceHints += clientManifest.initial.map(r => `<link rel=\"preload\" href=\"${publicPath}${r}\" as=\"script\" />`).join('')\r\n      }\r\n      // Pre-Fetch async resources\r\n      if (Array.isArray(clientManifest.async)) {\r\n        meta.resourceHints += clientManifest.async.map(r => `<link rel=\"prefetch\" href=\"${publicPath}${r}\" />`).join('')\r\n      }\r\n      // Add them to HEAD\r\n      if (meta.resourceHints) {\r\n        meta.HEAD += meta.resourceHints\r\n      }\r\n    }\r\n\r\n    // Set meta tags inside cache\r\n    this.cache.set(url, meta)\r\n\r\n    return meta\r\n  }\r\n}\r\n","import ansiHTML from 'ansi-html'\r\nimport serialize from 'serialize-javascript'\r\nimport generateETag from 'etag'\r\nimport fresh from 'fresh'\r\nimport serveStatic from 'serve-static'\r\nimport compression from 'compression'\r\nimport _ from 'lodash'\r\nimport { join, resolve } from 'path'\r\nimport fs from 'fs-extra'\r\nimport { createBundleRenderer } from 'vue-server-renderer'\r\nimport { getContext, setAnsiColors, isUrl, waitFor } from 'utils'\r\nimport Debug from 'debug'\r\nimport Youch from '@nuxtjs/youch'\r\nimport { SourceMapConsumer } from 'source-map'\r\nimport connect from 'connect'\r\nimport { Options } from 'common'\r\nimport MetaRenderer from './meta'\r\n\r\nconst debug = Debug('nuxt:render')\r\ndebug.color = 4 // Force blue color\r\n\r\nsetAnsiColors(ansiHTML)\r\n\r\nlet jsdom = null\r\n\r\nexport default class Renderer {\r\n  constructor(nuxt) {\r\n    this.nuxt = nuxt\r\n    this.options = nuxt.options\r\n\r\n    // Will be set by createRenderer\r\n    this.bundleRenderer = null\r\n    this.metaRenderer = null\r\n\r\n    // Will be available on dev\r\n    this.webpackDevMiddleware = null\r\n    this.webpackHotMiddleware = null\r\n\r\n    // Create new connect instance\r\n    this.app = connect()\r\n\r\n    // Renderer runtime resources\r\n    this.resources = {\r\n      clientManifest: null,\r\n      serverBundle: null,\r\n      ssrTemplate: null,\r\n      spaTemplate: null,\r\n      errorTemplate: parseTemplate('Nuxt.js Internal Server Error')\r\n    }\r\n  }\r\n\r\n  async ready() {\r\n    await this.nuxt.callHook('render:before', this, this.options.render)\r\n    // Setup nuxt middleware\r\n    await this.setupMiddleware()\r\n\r\n    // Production: Load SSR resources from fs\r\n    if (!this.options.dev) {\r\n      await this.loadResources()\r\n    }\r\n\r\n    // Call done hook\r\n    await this.nuxt.callHook('render:done', this)\r\n  }\r\n\r\n  async loadResources(_fs = fs) {\r\n    let distPath = resolve(this.options.buildDir, 'dist')\r\n    let updated = []\r\n\r\n    resourceMap.forEach(({ key, fileName, transform }) => {\r\n      let rawKey = '$$' + key\r\n      const path = join(distPath, fileName)\r\n\r\n      let rawData, data\r\n      if (!_fs.existsSync(path)) {\r\n        return // Resource not exists\r\n      }\r\n      rawData = _fs.readFileSync(path, 'utf8')\r\n      if (!rawData || rawData === this.resources[rawKey]) {\r\n        return // No changes\r\n      }\r\n      this.resources[rawKey] = rawData\r\n      data = transform(rawData)\r\n      /* istanbul ignore if */\r\n      if (!data) {\r\n        return // Invalid data ?\r\n      }\r\n      this.resources[key] = data\r\n      updated.push(key)\r\n    })\r\n\r\n    // Reload error template\r\n    const errorTemplatePath = resolve(this.options.buildDir, 'views/error.html')\r\n    if (fs.existsSync(errorTemplatePath)) {\r\n      this.resources.errorTemplate = parseTemplate(fs.readFileSync(errorTemplatePath, 'utf8'))\r\n    }\r\n\r\n    // Load loading template\r\n    const loadingHTMLPath = resolve(this.options.buildDir, 'loading.html')\r\n    if (fs.existsSync(loadingHTMLPath)) {\r\n      this.resources.loadingHTML = fs.readFileSync(loadingHTMLPath, 'utf8')\r\n      this.resources.loadingHTML = this.resources.loadingHTML.replace(/[\\r|\\n]/g, '')\r\n    } else {\r\n      this.resources.loadingHTML = ''\r\n    }\r\n\r\n    // Call resourcesLoaded plugin\r\n    await this.nuxt.callHook('render:resourcesLoaded', this.resources)\r\n\r\n    if (updated.length > 0) {\r\n      this.createRenderer()\r\n    }\r\n  }\r\n\r\n  get noSSR() {\r\n    return this.options.render.ssr === false\r\n  }\r\n\r\n  get isReady() {\r\n    if (this.noSSR) {\r\n      return Boolean(this.resources.spaTemplate)\r\n    }\r\n\r\n    return Boolean(this.bundleRenderer && this.resources.ssrTemplate)\r\n  }\r\n\r\n  get isResourcesAvailable() {\r\n    // Required for both\r\n    if (!this.resources.clientManifest) {\r\n      return false\r\n    }\r\n\r\n    // Required for SPA rendering\r\n    if (this.noSSR) {\r\n      return Boolean(this.resources.spaTemplate)\r\n    }\r\n\r\n    // Required for bundle renderer\r\n    return Boolean(this.resources.ssrTemplate && this.resources.serverBundle)\r\n  }\r\n\r\n  createRenderer() {\r\n    // Ensure resources are available\r\n    if (!this.isResourcesAvailable) {\r\n      return\r\n    }\r\n\r\n    // Create Meta Renderer\r\n    this.metaRenderer = new MetaRenderer(this.nuxt, this)\r\n\r\n    // Skip following steps if noSSR mode\r\n    if (this.noSSR) {\r\n      return\r\n    }\r\n\r\n    // Create bundle renderer for SSR\r\n    this.bundleRenderer = createBundleRenderer(this.resources.serverBundle, Object.assign({\r\n      clientManifest: this.resources.clientManifest,\r\n      runInNewContext: false,\r\n      basedir: this.options.rootDir\r\n    }, this.options.render.bundleRenderer))\r\n  }\r\n\r\n  useMiddleware(m) {\r\n    // Resolve\r\n    const $m = m\r\n    let src\r\n    if (typeof m === 'string') {\r\n      src = this.nuxt.resolvePath(m)\r\n      m = require(src)\r\n    }\r\n    if (typeof m.handler === 'string') {\r\n      src = this.nuxt.resolvePath(m.handler)\r\n      m.handler = require(src)\r\n    }\r\n\r\n    const handler = m.handler || m\r\n    const path = (((m.prefix !== false) ? this.options.router.base : '') + (typeof m.path === 'string' ? m.path : '')).replace(/\\/\\//g, '/')\r\n\r\n    // Inject $src and $m to final handler\r\n    if (src) handler.$src = src\r\n    handler.$m = $m\r\n\r\n    // Use middleware\r\n    this.app.use(path, handler)\r\n  }\r\n\r\n  get publicPath() {\r\n    return isUrl(this.options.build.publicPath) ? Options.defaults.build.publicPath : this.options.build.publicPath\r\n  }\r\n\r\n  async setupMiddleware() {\r\n    // Apply setupMiddleware from modules first\r\n    await this.nuxt.callHook('render:setupMiddleware', this.app)\r\n\r\n    // Gzip middleware for production\r\n    if (!this.options.dev && this.options.render.gzip) {\r\n      this.useMiddleware(compression(this.options.render.gzip))\r\n    }\r\n\r\n    // Common URL checks\r\n    this.useMiddleware((req, res, next) => {\r\n      // Prevent access to SSR resources\r\n      if (ssrResourceRegex.test(req.url)) {\r\n        res.statusCode = 404\r\n        return res.end()\r\n      }\r\n      next()\r\n    })\r\n\r\n    // Add webpack middleware only for development\r\n    if (this.options.dev) {\r\n      this.useMiddleware(async (req, res, next) => {\r\n        if (this.webpackDevMiddleware) {\r\n          await this.webpackDevMiddleware(req, res)\r\n        }\r\n        if (this.webpackHotMiddleware) {\r\n          await this.webpackHotMiddleware(req, res)\r\n        }\r\n        next()\r\n      })\r\n    }\r\n\r\n    // open in editor for debug mode only\r\n    const _this = this\r\n    if (this.options.debug) {\r\n      this.useMiddleware({\r\n        path: '_open',\r\n        handler(req, res) {\r\n          // Lazy load open-in-editor\r\n          const openInEditor = require('open-in-editor')\r\n          const editor = openInEditor.configure(_this.options.editor)\r\n          // Parse Query\r\n          const query = req.url.split('?')[1].split('&').reduce((q, part) => {\r\n            const s = part.split('=')\r\n            q[s[0]] = decodeURIComponent(s[1])\r\n            return q\r\n          }, {})\r\n          // eslint-disable-next-line no-console\r\n          console.log('[open in editor]', query.file)\r\n          editor.open(query.file).then(() => {\r\n            res.end('opened in editor!')\r\n          }).catch(err => {\r\n            res.end(err)\r\n          })\r\n        }\r\n      })\r\n    }\r\n\r\n    // For serving static/ files to /\r\n    this.useMiddleware(serveStatic(resolve(this.options.srcDir, 'static'), this.options.render.static))\r\n\r\n    // Serve .nuxt/dist/ files only for production\r\n    // For dev they will be served with devMiddleware\r\n    if (!this.options.dev) {\r\n      const distDir = resolve(this.options.buildDir, 'dist')\r\n      this.useMiddleware({\r\n        path: this.publicPath,\r\n        handler: serveStatic(distDir, {\r\n          index: false, // Don't serve index.html template\r\n          maxAge: '1y' // 1 year in production\r\n        })\r\n      })\r\n    }\r\n\r\n    // Add User provided middleware\r\n    this.options.serverMiddleware.forEach(m => {\r\n      this.useMiddleware(m)\r\n    })\r\n\r\n    // Finally use nuxtMiddleware\r\n    this.useMiddleware(this.nuxtMiddleware.bind(this))\r\n\r\n    // Error middleware for errors that occurred in middleware that declared above\r\n    // Middleware should exactly take 4 arguments\r\n    // https://github.com/senchalabs/connect#error-middleware\r\n    this.useMiddleware(this.errorMiddleware.bind(this))\r\n  }\r\n\r\n  async nuxtMiddleware(req, res, next) {\r\n    // Get context\r\n    const context = getContext(req, res)\r\n\r\n    res.statusCode = 200\r\n    try {\r\n      const result = await this.renderRoute(req.url, context)\r\n      await this.nuxt.callHook('render:route', req.url, result)\r\n      const { html, error, redirected, resourceHints } = result\r\n\r\n      if (redirected) {\r\n        return html\r\n      }\r\n      if (error) {\r\n        res.statusCode = context.nuxt.error.statusCode || 500\r\n      }\r\n\r\n      // Add ETag header\r\n      if (!error && this.options.render.etag) {\r\n        const etag = generateETag(html, this.options.render.etag)\r\n        if (fresh(req.headers, { etag })) {\r\n          res.statusCode = 304\r\n          res.end()\r\n          return\r\n        }\r\n        res.setHeader('ETag', etag)\r\n      }\r\n\r\n      // HTTP2 push headers\r\n      if (!error && this.options.render.http2.push) {\r\n        // Parse resourceHints to extract HTTP.2 prefetch/push headers\r\n        // https://w3c.github.io/preload/#server-push-http-2\r\n        const regex = /link rel=\"([^\"]*)\" href=\"([^\"]*)\" as=\"([^\"]*)\"/g\r\n        const pushAssets = []\r\n        let m\r\n        while (m = regex.exec(resourceHints)) { // eslint-disable-line no-cond-assign\r\n          const [, rel, href, as] = m\r\n          if (rel === 'preload') {\r\n            pushAssets.push(`<${href}>; rel=${rel}; as=${as}`)\r\n          }\r\n        }\r\n        // Pass with single Link header\r\n        // https://blog.cloudflare.com/http-2-server-push-with-multiple-assets-per-link-header\r\n        res.setHeader('Link', pushAssets.join(','))\r\n      }\r\n\r\n      // Send response\r\n      res.setHeader('Content-Type', 'text/html; charset=utf-8')\r\n      res.setHeader('Content-Length', Buffer.byteLength(html))\r\n      res.end(html, 'utf8')\r\n      return html\r\n    } catch (err) {\r\n      /* istanbul ignore if */\r\n      if (context && context.redirected) {\r\n        console.error(err) // eslint-disable-line no-console\r\n        return err\r\n      }\r\n\r\n      next(err)\r\n    }\r\n  }\r\n\r\n  errorMiddleware(err, req, res, next) {\r\n    // ensure statusCode, message and name fields\r\n    err.statusCode = err.statusCode || 500\r\n    err.message = err.message || 'Nuxt Server Error'\r\n    err.name = (!err.name || err.name === 'Error') ? 'NuxtServerError' : err.name\r\n\r\n    // We hide actual errors from end users, so show them on server logs\r\n    if (err.statusCode !== 404) {\r\n      console.error(err) // eslint-disable-line no-console\r\n    }\r\n\r\n    const sendResponse = (content, type = 'text/html') => {\r\n      // Set Headers\r\n      res.statusCode = err.statusCode\r\n      res.statusMessage = err.name\r\n      res.setHeader('Content-Type', type + '; charset=utf-8')\r\n      res.setHeader('Content-Length', Buffer.byteLength(content))\r\n\r\n      // Send Response\r\n      res.end(content, 'utf-8')\r\n    }\r\n\r\n    // Check if request accepts JSON\r\n    const hasReqHeader = (header, includes) => req.headers[header] && req.headers[header].toLowerCase().includes(includes)\r\n    const isJson = hasReqHeader('accept', 'application/json') || hasReqHeader('user-agent', 'curl/')\r\n\r\n    // Use basic errors when debug mode is disabled\r\n    if (!this.options.debug) {\r\n      // Json format is compatible with Youch json responses\r\n      const json = {\r\n        status: err.statusCode,\r\n        message: err.message,\r\n        name: err.name\r\n      }\r\n      if (isJson) {\r\n        sendResponse(JSON.stringify(json, undefined, 2), 'text/json')\r\n        return\r\n      }\r\n      const html = this.resources.errorTemplate(json)\r\n      sendResponse(html)\r\n      return\r\n    }\r\n\r\n    // Show stack trace\r\n    const youch = new Youch(err, req, this.readSource.bind(this))\r\n    if (isJson) {\r\n      youch.toJSON().then(json => { sendResponse(JSON.stringify(json, undefined, 2), 'text/json') })\r\n    } else {\r\n      youch.toHTML().then(html => { sendResponse(html) })\r\n    }\r\n  }\r\n\r\n  async readSource(frame) {\r\n    const serverBundle = this.resources.serverBundle\r\n\r\n    // Remove webpack:/// & query string from the end\r\n    const sanitizeName = name => name ? name.replace('webpack:///', '').split('?')[0] : ''\r\n\r\n    // SourceMap Support for SSR Bundle\r\n    if (serverBundle && serverBundle.maps[frame.fileName]) {\r\n      // Initialize smc cache\r\n      if (!serverBundle.$maps) {\r\n        serverBundle.$maps = {}\r\n      }\r\n\r\n      // Read SourceMap object\r\n      const smc = serverBundle.$maps[frame.fileName] || new SourceMapConsumer(serverBundle.maps[frame.fileName])\r\n      serverBundle.$maps[frame.fileName] = smc\r\n\r\n      // Try to find original position\r\n      const { line, column, name, source } = smc.originalPositionFor({\r\n        line: frame.getLineNumber() || 0,\r\n        column: frame.getColumnNumber() || 0,\r\n        bias: SourceMapConsumer.LEAST_UPPER_BOUND\r\n      })\r\n      if (line) {\r\n        frame.lineNumber = line\r\n      }\r\n      if (column) {\r\n        frame.columnNumber = column\r\n      }\r\n      if (name) {\r\n        frame.functionName = name\r\n      }\r\n      if (source) {\r\n        frame.fileName = sanitizeName(source)\r\n\r\n        // Source detected, try to get original source code\r\n        const contents = smc.sourceContentFor(source)\r\n        if (contents) {\r\n          frame.contents = contents\r\n        }\r\n      }\r\n    }\r\n\r\n    // Return if fileName is still unknown\r\n    if (!frame.fileName) {\r\n      return\r\n    }\r\n\r\n    frame.fileName = sanitizeName(frame.fileName)\r\n\r\n    // Try to read from SSR bundle files\r\n    if (serverBundle && serverBundle.files[frame.fileName]) {\r\n      frame.contents = serverBundle.files[frame.fileName]\r\n      return\r\n    }\r\n\r\n    // Possible paths for file\r\n    const searchPath = [\r\n      this.options.rootDir,\r\n      join(this.options.buildDir, 'dist'),\r\n      this.options.srcDir,\r\n      this.options.buildDir\r\n    ]\r\n\r\n    // Scan filesystem for real path\r\n    for (let pathDir of searchPath) {\r\n      let fullPath = resolve(pathDir, frame.fileName)\r\n      let source = await fs.readFile(fullPath, 'utf-8').catch(() => null)\r\n      if (source) {\r\n        if (!frame.contents) {\r\n          frame.contents = source\r\n        }\r\n        frame.fullPath = fullPath\r\n        return\r\n      }\r\n    }\r\n  }\r\n\r\n  async renderRoute(url, context = {}) {\r\n    /* istanbul ignore if */\r\n    if (!this.isReady) {\r\n      await waitFor(1000)\r\n      return this.renderRoute(url, context)\r\n    }\r\n\r\n    // Log rendered url\r\n    debug(`Rendering url ${url}`)\r\n\r\n    // Add url and isSever to the context\r\n    context.url = url\r\n\r\n    // Basic response if SSR is disabled or spa data provided\r\n    const spa = context.spa || (context.res && context.res.spa)\r\n    const ENV = this.options.env\r\n\r\n    if (this.noSSR || spa) {\r\n      const { HTML_ATTRS, BODY_ATTRS, HEAD, BODY_SCRIPTS, resourceHints } = await this.metaRenderer.render(context)\r\n      const APP = `<div id=\"__nuxt\">${this.resources.loadingHTML}</div>` + BODY_SCRIPTS\r\n\r\n      // Detect 404 errors\r\n      if (url.includes(this.options.build.publicPath) || url.includes('__webpack')) {\r\n        const err = { statusCode: 404, message: this.options.messages.error_404, name: 'ResourceNotFound' }\r\n        throw err\r\n      }\r\n\r\n      const html = this.resources.spaTemplate({\r\n        HTML_ATTRS,\r\n        BODY_ATTRS,\r\n        HEAD,\r\n        APP,\r\n        ENV\r\n      })\r\n\r\n      return { html, resourceHints }\r\n    }\r\n\r\n    // Call renderToString from the bundleRenderer and generate the HTML (will update the context as well)\r\n    let APP = await this.bundleRenderer.renderToString(context)\r\n\r\n    if (!context.nuxt.serverRendered) {\r\n      APP = '<div id=\"__nuxt\"></div>'\r\n    }\r\n    const m = context.meta.inject()\r\n    let HEAD = m.meta.text() + m.title.text() + m.link.text() + m.style.text() + m.script.text() + m.noscript.text()\r\n    if (this.options._routerBaseSpecified) {\r\n      HEAD += `<base href=\"${this.options.router.base}\">`\r\n    }\r\n\r\n    let resourceHints = ''\r\n\r\n    if (this.options.render.resourceHints) {\r\n      resourceHints = context.renderResourceHints()\r\n      HEAD += resourceHints\r\n    }\r\n    APP += `<script type=\"text/javascript\">window.__NUXT__=${serialize(context.nuxt, { isJSON: true })};</script>`\r\n    APP += context.renderScripts()\r\n    APP += m.script.text({ body: true })\r\n\r\n    HEAD += context.renderStyles()\r\n\r\n    let html = this.resources.ssrTemplate({\r\n      HTML_ATTRS: 'data-n-head-ssr ' + m.htmlAttrs.text(),\r\n      BODY_ATTRS: m.bodyAttrs.text(),\r\n      HEAD,\r\n      APP,\r\n      ENV\r\n    })\r\n\r\n    return {\r\n      html,\r\n      resourceHints,\r\n      error: context.nuxt.error,\r\n      redirected: context.redirected\r\n    }\r\n  }\r\n\r\n  async renderAndGetWindow(url, opts = {}) {\r\n    /* istanbul ignore if */\r\n    if (!jsdom) {\r\n      try {\r\n        jsdom = require('jsdom')\r\n      } catch (e) /* istanbul ignore next */ {\r\n        /* eslint-disable no-console */\r\n        console.error('Fail when calling nuxt.renderAndGetWindow(url)')\r\n        console.error('jsdom module is not installed')\r\n        console.error('Please install jsdom with: npm install --save-dev jsdom')\r\n        /* eslint-enable no-console */\r\n        throw e\r\n      }\r\n    }\r\n    let options = {\r\n      resources: 'usable', // load subresources (https://github.com/tmpvar/jsdom#loading-subresources)\r\n      runScripts: 'dangerously',\r\n      beforeParse(window) {\r\n        // Mock window.scrollTo\r\n        window.scrollTo = () => {}\r\n      }\r\n    }\r\n    if (opts.virtualConsole !== false) {\r\n      options.virtualConsole = new jsdom.VirtualConsole().sendTo(console)\r\n    }\r\n    url = url || 'http://localhost:3000'\r\n    const { window } = await jsdom.JSDOM.fromURL(url, options)\r\n    // If Nuxt could not be loaded (error from the server-side)\r\n    const nuxtExists = window.document.body.innerHTML.includes(this.options.render.ssr ? 'window.__NUXT__' : '<div id=\"__nuxt\">')\r\n    /* istanbul ignore if */\r\n    if (!nuxtExists) {\r\n      let error = new Error('Could not load the nuxt app')\r\n      error.body = window.document.body.innerHTML\r\n      throw error\r\n    }\r\n    // Used by nuxt.js to say when the components are loaded and the app ready\r\n    await new Promise((resolve) => {\r\n      window._onNuxtLoaded = () => resolve(window)\r\n    })\r\n    // Send back window object\r\n    return window\r\n  }\r\n}\r\n\r\nconst parseTemplate = templateStr => _.template(templateStr, {\r\n  interpolate: /{{([\\s\\S]+?)}}/g\r\n})\r\n\r\nconst resourceMap = [\r\n  {\r\n    key: 'clientManifest',\r\n    fileName: 'vue-ssr-client-manifest.json',\r\n    transform: JSON.parse\r\n  },\r\n  {\r\n    key: 'serverBundle',\r\n    fileName: 'server-bundle.json',\r\n    transform: JSON.parse\r\n  },\r\n  {\r\n    key: 'ssrTemplate',\r\n    fileName: 'index.ssr.html',\r\n    transform: parseTemplate\r\n  },\r\n  {\r\n    key: 'spaTemplate',\r\n    fileName: 'index.spa.html',\r\n    transform: parseTemplate\r\n  }\r\n]\r\n\r\n// Protector utility against request to SSR bundle files\r\nconst ssrResourceRegex = new RegExp(resourceMap.map(resource => resource.fileName).join('|'), 'i')\r\n","import chalk from 'chalk'\r\nimport { Options } from 'common'\r\nimport { sequence } from 'utils'\r\nimport ModuleContainer from './module'\r\nimport Renderer from './renderer'\r\nimport Debug from 'debug'\r\nimport enableDestroy from 'server-destroy'\r\nimport Module from 'module'\r\nimport { isPlainObject } from 'lodash'\r\nimport { join, resolve } from 'path'\r\n\r\nconst debug = Debug('nuxt:')\r\ndebug.color = 5\r\n\r\nexport default class Nuxt {\r\n  constructor(options = {}) {\r\n    this.options = Options.from(options)\r\n\r\n    // Paths for resolving requires from `rootDir`\r\n    this.nodeModulePaths = Module._nodeModulePaths(this.options.rootDir)\r\n\r\n    if (this.options.nuxtDir.indexOf(this.options.rootDir) !== 0) {\r\n      this.nodeModulePaths = [\r\n        ...this.nodeModulePaths,\r\n        ...Module._nodeModulePaths(this.options.nuxtDir)\r\n      ]\r\n    }\r\n\r\n    this.initialized = false\r\n    this.errorHandler = this.errorHandler.bind(this)\r\n    // Hooks\r\n    this._hooks = {}\r\n    this.hook = this.hook.bind(this)\r\n\r\n    // Create instance of core components\r\n    this.moduleContainer = new ModuleContainer(this)\r\n    this.renderer = new Renderer(this)\r\n\r\n    // Backward compatibility\r\n    this.render = this.renderer.app\r\n    this.renderRoute = this.renderer.renderRoute.bind(this.renderer)\r\n    this.renderAndGetWindow = this.renderer.renderAndGetWindow.bind(this.renderer)\r\n\r\n    this._ready = this.ready().catch(this.errorHandler)\r\n  }\r\n\r\n  async ready() {\r\n    if (this._ready) {\r\n      return this._ready\r\n    }\r\n\r\n    // Add hooks\r\n    if (isPlainObject(this.options.hooks)) {\r\n      this.addObjectHooks(this.options.hooks)\r\n    } else if (typeof this.options.hooks === 'function') {\r\n      this.options.hooks(this.hook)\r\n    }\r\n    // Add nuxt modules\r\n    await this.moduleContainer.ready()\r\n    await this.renderer.ready()\r\n\r\n    this.initialized = true\r\n    await this.callHook('ready', this)\r\n\r\n    return this\r\n  }\r\n\r\n  plugin(name, fn) {\r\n    // eslint-disable-next-line no-console\r\n    console.error(`[warn] nuxt.plugin('${name}',..) is deprecated. Please use new hooks system.`)\r\n\r\n    // A tiny backward compatibility util\r\n    const hookMap = {\r\n      'ready': 'ready',\r\n      'close': 'close',\r\n      'listen': 'listen',\r\n      'built': 'build:done'\r\n    }\r\n\r\n    if (hookMap[name]) {\r\n      this.hook(hookMap[name], fn)\r\n    }\r\n\r\n    // Always return nuxt class which has plugin() for two level hooks\r\n    return this\r\n  }\r\n\r\n  hook(name, fn) {\r\n    if (!name || typeof fn !== 'function') {\r\n      return\r\n    }\r\n    this._hooks[name] = this._hooks[name] || []\r\n    this._hooks[name].push(fn)\r\n  }\r\n\r\n  async callHook(name, ...args) {\r\n    if (!this._hooks[name]) {\r\n      return\r\n    }\r\n    debug(`Call ${name} hooks (${this._hooks[name].length})`)\r\n    try {\r\n      await sequence(this._hooks[name], (fn) => fn(...args))\r\n    } catch (err) {\r\n      console.error(`> Error on hook \"${name}\":`) // eslint-disable-line no-console\r\n      console.error(err) // eslint-disable-line no-console\r\n    }\r\n  }\r\n\r\n  addObjectHooks(hooksObj) {\r\n    Object.keys(hooksObj).forEach((name) => {\r\n      let hooks = hooksObj[name]\r\n      hooks = (Array.isArray(hooks) ? hooks : [hooks])\r\n\r\n      hooks.forEach((hook) => {\r\n        this.hook(name, hook)\r\n      })\r\n    })\r\n  }\r\n\r\n  listen(port = 3000, host = 'localhost') {\r\n    return new Promise((resolve, reject) => {\r\n      const server = this.renderer.app.listen({ port, host, exclusive: false }, (err) => {\r\n        /* istanbul ignore if */\r\n        if (err) {\r\n          return reject(err)\r\n        }\r\n\r\n        const _host = host === '0.0.0.0' ? 'localhost' : host\r\n        // eslint-disable-next-line no-console\r\n        console.log('\\n' + chalk.bgGreen.black(' OPEN ') + chalk.green(` http://${_host}:${port}\\n`))\r\n\r\n        // Close server on nuxt close\r\n        this.hook('close', () => new Promise((resolve, reject) => {\r\n          // Destroy server by forcing every connection to be closed\r\n          server.destroy(err => {\r\n            debug('server closed')\r\n            /* istanbul ignore if */\r\n            if (err) {\r\n              return reject(err)\r\n            }\r\n            resolve()\r\n          })\r\n        }))\r\n\r\n        this.callHook('listen', server, { port, host }).then(resolve)\r\n      })\r\n\r\n      // Add server.destroy(cb) method\r\n      enableDestroy(server)\r\n    })\r\n  }\r\n\r\n  errorHandler/* istanbul ignore next */() {\r\n    // Apply plugins\r\n    // eslint-disable-next-line no-console\r\n    this.callHook('error', ...arguments).catch(console.error)\r\n\r\n    // Silent\r\n    if (this.options.errorHandler === false) {\r\n      return\r\n    }\r\n\r\n    // Custom errorHandler\r\n    if (typeof this.options.errorHandler === 'function') {\r\n      return this.options.errorHandler.apply(this, arguments)\r\n    }\r\n\r\n    // Default handler\r\n    // eslint-disable-next-line no-console\r\n    console.error(...arguments)\r\n  }\r\n\r\n  resolvePath(path) {\r\n    // Try to resolve using NPM resolve path first\r\n    try {\r\n      let resolvedPath = Module._resolveFilename(path, { paths: this.nodeModulePaths })\r\n      return resolvedPath\r\n    } catch (e) {\r\n      // Just continue\r\n    }\r\n    // Shorthand to resolve from project dirs\r\n    if (path.indexOf('@@') === 0 || path.indexOf('~~') === 0) {\r\n      return join(this.options.rootDir, path.substr(2))\r\n    } else if (path.indexOf('@') === 0 || path.indexOf('~') === 0) {\r\n      return join(this.options.srcDir, path.substr(1))\r\n    }\r\n    return resolve(this.options.srcDir, path)\r\n  }\r\n\r\n  async close(callback) {\r\n    await this.callHook('close', this)\r\n\r\n    /* istanbul ignore if */\r\n    if (typeof callback === 'function') {\r\n      await callback()\r\n    }\r\n  }\r\n}\r\n","// Taken from https://github.com/egoist/poi/blob/3e93c88c520db2d20c25647415e6ae0d3de61145/packages/poi/lib/webpack/timefix-plugin.js#L1-L16\r\n// Thanks to @egoist\r\nexport default class TimeFixPlugin {\r\n  constructor(timefix = 11000) {\r\n    this.timefix = timefix\r\n  }\r\n\r\n  apply(compiler) {\r\n    compiler.plugin('watch-run', (watching, callback) => {\r\n      watching.startTime += this.timefix\r\n      callback()\r\n    })\r\n\r\n    compiler.plugin('done', stats => {\r\n      stats.startTime -= this.timefix\r\n    })\r\n  }\r\n}\r\n","import ExtractTextPlugin from 'extract-text-webpack-plugin'\r\nimport { cloneDeep } from 'lodash'\r\nimport { join, resolve } from 'path'\r\nimport webpack from 'webpack'\r\nimport { isUrl, urlJoin } from 'utils'\r\nimport TimeFixPlugin from './timefix-plugin'\r\n\r\n/*\r\n|--------------------------------------------------------------------------\r\n| Webpack Shared Config\r\n|\r\n| This is the config which is extended by the server and client\r\n| webpack config files\r\n|--------------------------------------------------------------------------\r\n*/\r\nexport default function webpackBaseConfig(name) {\r\n  const nodeModulesDir = join(__dirname, '..', 'node_modules')\r\n\r\n  const config = {\r\n    name,\r\n    devtool: this.options.dev ? 'cheap-module-source-map' : 'nosources-source-map',\r\n    entry: {\r\n      app: null\r\n    },\r\n    output: {\r\n      path: resolve(this.options.buildDir, 'dist'),\r\n      filename: this.options.build.filenames.app,\r\n      chunkFilename: this.options.build.filenames.chunk,\r\n      publicPath: (isUrl(this.options.build.publicPath)\r\n        ? this.options.build.publicPath\r\n        : urlJoin(this.options.router.base, this.options.build.publicPath))\r\n    },\r\n    performance: {\r\n      maxEntrypointSize: 1000000,\r\n      maxAssetSize: 300000,\r\n      hints: this.options.dev ? false : 'warning'\r\n    },\r\n    resolve: {\r\n      extensions: ['.js', '.json', '.vue', '.ts'],\r\n      alias: {\r\n        '~': join(this.options.srcDir),\r\n        '~~': join(this.options.rootDir),\r\n        '@': join(this.options.srcDir),\r\n        '@@': join(this.options.rootDir),\r\n        // Used by vue-loader so we can use in templates\r\n        // with <img src=\"~/assets/nuxt.png\"/>\r\n        'assets': join(this.options.srcDir, 'assets'),\r\n        'static': join(this.options.srcDir, 'static')\r\n      },\r\n      modules: [\r\n        ...this.options.modulesDir,\r\n        nodeModulesDir\r\n      ]\r\n    },\r\n    resolveLoader: {\r\n      modules: [\r\n        ...this.options.modulesDir,\r\n        nodeModulesDir\r\n      ]\r\n    },\r\n    module: {\r\n      noParse: /es6-promise\\.js$/, // Avoid webpack shimming process\r\n      rules: [\r\n        {\r\n          test: /\\.vue$/,\r\n          loader: 'vue-loader',\r\n          options: this.vueLoader()\r\n        },\r\n        {\r\n          test: /\\.js$/,\r\n          loader: 'babel-loader',\r\n          exclude: /node_modules/,\r\n          options: Object.assign({}, this.babelOptions)\r\n        },\r\n        { test: /\\.css$/, use: this.styleLoader('css') },\r\n        { test: /\\.less$/, use: this.styleLoader('less', 'less-loader') },\r\n        { test: /\\.sass$/, use: this.styleLoader('sass', {loader: 'sass-loader', options: { indentedSyntax: true }}) },\r\n        { test: /\\.scss$/, use: this.styleLoader('scss', 'sass-loader') },\r\n        { test: /\\.styl(us)?$/, use: this.styleLoader('stylus', 'stylus-loader') },\r\n        {\r\n          test: /\\.(png|jpe?g|gif|svg)$/,\r\n          loader: 'url-loader',\r\n          options: {\r\n            limit: 1000, // 1KO\r\n            name: 'img/[name].[hash:7].[ext]'\r\n          }\r\n        },\r\n        {\r\n          test: /\\.(woff2?|eot|ttf|otf)(\\?.*)?$/,\r\n          loader: 'url-loader',\r\n          options: {\r\n            limit: 1000, // 1 KO\r\n            name: 'fonts/[name].[hash:7].[ext]'\r\n          }\r\n        },\r\n        {\r\n          test: /\\.(webm|mp4)$/,\r\n          loader: 'file-loader',\r\n          options: {\r\n            name: 'videos/[name].[hash:7].[ext]'\r\n          }\r\n        }\r\n      ]\r\n    },\r\n    plugins: this.options.build.plugins\r\n  }\r\n\r\n  // Add timefix-plugin before others plugins\r\n  config.plugins.unshift(new TimeFixPlugin())\r\n\r\n  // CSS extraction\r\n  const extractCSS = this.options.build.extractCSS\r\n  if (extractCSS) {\r\n    const extractOptions = Object.assign(\r\n      { filename: this.options.build.filenames.css },\r\n      typeof extractCSS === 'object' ? extractCSS : {}\r\n    )\r\n    config.plugins.push(new ExtractTextPlugin(extractOptions))\r\n  }\r\n\r\n  // Workaround for hiding Warnings about plugins without a default export (#1179)\r\n  config.plugins.push({\r\n    apply(compiler) {\r\n      compiler.plugin('done', stats => {\r\n        stats.compilation.warnings = stats.compilation.warnings.filter(warn => {\r\n          if (warn.name === 'ModuleDependencyWarning' && warn.message.includes(`export 'default'`) && warn.message.includes('plugin')) {\r\n            return false\r\n          }\r\n          return true\r\n        })\r\n      })\r\n    }\r\n  })\r\n\r\n  // --------------------------------------\r\n  // Dev specific config\r\n  // --------------------------------------\r\n  if (this.options.dev) {\r\n    //\r\n  }\r\n\r\n  // --------------------------------------\r\n  // Production specific config\r\n  // --------------------------------------\r\n  if (!this.options.dev) {\r\n    // This is needed in webpack 2 for minify CSS\r\n    config.plugins.push(\r\n      new webpack.LoaderOptionsPlugin({\r\n        minimize: true\r\n      })\r\n    )\r\n  }\r\n\r\n  // Clone deep avoid leaking config between Client and Server\r\n  return cloneDeep(config)\r\n}\r\n","import { each } from 'lodash'\r\nimport webpack from 'webpack'\r\nimport VueSSRClientPlugin from 'vue-server-renderer/client-plugin'\r\nimport HTMLPlugin from 'html-webpack-plugin'\r\nimport FriendlyErrorsWebpackPlugin from 'friendly-errors-webpack-plugin'\r\nimport UglifyJSPlugin from 'uglifyjs-webpack-plugin'\r\nimport ProgressBarPlugin from 'progress-bar-webpack-plugin'\r\nimport { BundleAnalyzerPlugin } from 'webpack-bundle-analyzer'\r\nimport { resolve } from 'path'\r\nimport { existsSync } from 'fs'\r\nimport Debug from 'debug'\r\nimport base from './base.config.js'\r\n\r\nconst debug = Debug('nuxt:build')\r\ndebug.color = 2 // Force green color\r\n\r\n/*\r\n|--------------------------------------------------------------------------\r\n| Webpack Client Config\r\n|\r\n| Generate public/dist/client-vendor-bundle.js\r\n| Generate public/dist/client-bundle.js\r\n|\r\n| In production, will generate public/dist/style.css\r\n|--------------------------------------------------------------------------\r\n*/\r\nexport default function webpackClientConfig() {\r\n  let config = base.call(this, 'client')\r\n\r\n  // Entry points\r\n  config.entry.app = resolve(this.options.buildDir, 'client.js')\r\n  config.entry.vendor = this.vendor()\r\n\r\n  // Add CommonChunks plugin\r\n  commonChunksPlugin.call(this, config)\r\n\r\n  // Env object defined in nuxt.config.js\r\n  let env = {}\r\n  each(this.options.env, (value, key) => {\r\n    env['process.env.' + key] = (['boolean', 'number'].indexOf(typeof value) !== -1 ? value : JSON.stringify(value))\r\n  })\r\n\r\n  // Generate output HTML for SPA\r\n  config.plugins.push(\r\n    new HTMLPlugin({\r\n      filename: 'index.spa.html',\r\n      template: this.options.appTemplatePath,\r\n      inject: true,\r\n      chunksSortMode: 'dependency'\r\n    })\r\n  )\r\n\r\n  // Generate output HTML for SSR\r\n  if (this.options.build.ssr) {\r\n    config.plugins.push(\r\n      new HTMLPlugin({\r\n        filename: 'index.ssr.html',\r\n        template: this.options.appTemplatePath,\r\n        inject: false // Resources will be injected using bundleRenderer\r\n      })\r\n    )\r\n  }\r\n\r\n  // Generate vue-ssr-client-manifest\r\n  config.plugins.push(\r\n    new VueSSRClientPlugin({\r\n      filename: 'vue-ssr-client-manifest.json'\r\n    })\r\n  )\r\n\r\n  // Extract webpack runtime & manifest\r\n  config.plugins.push(\r\n    new webpack.optimize.CommonsChunkPlugin({\r\n      name: 'manifest',\r\n      minChunks: Infinity,\r\n      filename: this.options.build.filenames.manifest\r\n    })\r\n  )\r\n\r\n  // Define Env\r\n  config.plugins.push(\r\n    new webpack.DefinePlugin(Object.assign(env, {\r\n      'process.env.NODE_ENV': JSON.stringify(env.NODE_ENV || (this.options.dev ? 'development' : 'production')),\r\n      'process.env.VUE_ENV': JSON.stringify('client'),\r\n      'process.mode': JSON.stringify(this.options.mode),\r\n      'process.browser': true,\r\n      'process.client': true,\r\n      'process.server': false,\r\n      'process.static': this.isStatic\r\n    }))\r\n  )\r\n\r\n  // Build progress bar\r\n  config.plugins.push(\r\n    new ProgressBarPlugin()\r\n  )\r\n\r\n  // --------------------------------------\r\n  // Dev specific config\r\n  // --------------------------------------\r\n  if (this.options.dev) {\r\n    // Add friendly error plugin\r\n    config.plugins.push(new FriendlyErrorsWebpackPlugin())\r\n\r\n    // https://webpack.js.org/plugins/named-modules-plugin\r\n    config.plugins.push(new webpack.NamedModulesPlugin())\r\n\r\n    // Add HMR support\r\n    config.entry.app = [\r\n      // https://github.com/glenjamin/webpack-hot-middleware#config\r\n      `webpack-hot-middleware/client?name=client&reload=true&timeout=30000&path=${this.options.router.base}/__webpack_hmr`.replace(/\\/\\//g, '/'),\r\n      config.entry.app\r\n    ]\r\n    config.plugins.push(\r\n      new webpack.HotModuleReplacementPlugin(),\r\n      new webpack.NoEmitOnErrorsPlugin()\r\n    )\r\n\r\n    // DllReferencePlugin\r\n    if (this.options.build.dll) {\r\n      dllPlugin.call(this, config)\r\n    }\r\n  }\r\n\r\n  // --------------------------------------\r\n  // Production specific config\r\n  // --------------------------------------\r\n  if (!this.options.dev) {\r\n    // Scope Hoisting\r\n    if (this.options.build.scopeHoisting === true) {\r\n      config.plugins.push(new webpack.optimize.ModuleConcatenationPlugin())\r\n    }\r\n\r\n    // https://webpack.js.org/plugins/hashed-module-ids-plugin\r\n    config.plugins.push(new webpack.HashedModuleIdsPlugin())\r\n\r\n    // Minify JS\r\n    // https://github.com/webpack-contrib/uglifyjs-webpack-plugin\r\n    if (this.options.build.uglify !== false) {\r\n      config.plugins.push(\r\n        new UglifyJSPlugin(Object.assign({\r\n          cache: true,\r\n          sourceMap: true,\r\n          parallel: true,\r\n          extractComments: {\r\n            filename: 'LICENSES'\r\n          },\r\n          uglifyOptions: {\r\n            output: {\r\n              comments: /^\\**!|@preserve|@license|@cc_on/\r\n            }\r\n          }\r\n        }, this.options.build.uglify))\r\n      )\r\n    }\r\n\r\n    // Webpack Bundle Analyzer\r\n    if (this.options.build.analyze) {\r\n      config.plugins.push(new BundleAnalyzerPlugin(Object.assign({}, this.options.build.analyze)))\r\n    }\r\n  }\r\n\r\n  // Extend config\r\n  if (typeof this.options.build.extend === 'function') {\r\n    const isDev = this.options.dev\r\n    const extendedConfig = this.options.build.extend.call(this, config, {\r\n      get dev() {\r\n        console.warn('dev has been deprecated in build.extend(), please use isDev') // eslint-disable-line no-console\r\n        return isDev\r\n      },\r\n      isDev,\r\n      isClient: true\r\n    })\r\n    // Only overwrite config when something is returned for backwards compatibility\r\n    if (extendedConfig !== undefined) {\r\n      config = extendedConfig\r\n    }\r\n  }\r\n\r\n  return config\r\n}\r\n\r\n// --------------------------------------------------------------------------\r\n// Adds Common Chunks Plugin\r\n// --------------------------------------------------------------------------\r\nfunction commonChunksPlugin(config) {\r\n  const _this = this\r\n  const totalPages = _this.routes ? _this.routes.length : 0\r\n\r\n  // This well-known vendor may exist as a dependency of other requests.\r\n  const maybeVendor = [\r\n    '/core-js/',\r\n    '/regenerator-runtime/',\r\n    '/es6-promise/',\r\n    '/babel-runtime/',\r\n    '/lodash/'\r\n  ]\r\n\r\n  // Create explicit vendor chunk\r\n  config.plugins.unshift(\r\n    new webpack.optimize.CommonsChunkPlugin({\r\n      name: 'vendor',\r\n      filename: this.options.build.filenames.vendor,\r\n      minChunks(module, count) {\r\n        // Detect and externalize well-known vendor if detected\r\n        if (module.context && maybeVendor.some(v => module.context.includes(v))) {\r\n          return true\r\n        }\r\n        // A module is extracted into the vendor chunk when...\r\n        return (\r\n          // If it's inside node_modules\r\n          /node_modules/.test(module.context) &&\r\n          // Do not externalize if the request is a CSS file\r\n          !/\\.(css|less|scss|sass|styl|stylus)$/.test(module.request) &&\r\n          // Used in at-least 1/2 of the total pages\r\n          (totalPages <= 2 ? count >= totalPages : count >= totalPages * 0.5)\r\n        )\r\n      }\r\n    })\r\n  )\r\n}\r\n\r\n// --------------------------------------------------------------------------\r\n// Adds DLL plugin\r\n// https://github.com/webpack/webpack/tree/master/examples/dll-user\r\n// --------------------------------------------------------------------------\r\nfunction dllPlugin(config) {\r\n  const _dlls = []\r\n  const vendorEntries = this.vendorEntries()\r\n  const dllDir = resolve(this.options.cacheDir, config.name + '-dll')\r\n  Object.keys(vendorEntries).forEach(v => {\r\n    const dllManifestFile = resolve(dllDir, v + '-manifest.json')\r\n    if (existsSync(dllManifestFile)) {\r\n      _dlls.push(v)\r\n      config.plugins.push(\r\n        new webpack.DllReferencePlugin({\r\n          // context: this.options.rootDir,\r\n          manifest: dllManifestFile // Using full path to allow finding .js dll file\r\n        })\r\n      )\r\n    }\r\n  })\r\n  if (_dlls.length) {\r\n    debug('Using dll for ' + _dlls.join(','))\r\n  }\r\n}\r\n","import webpack from 'webpack'\r\nimport VueSSRServerPlugin from 'vue-server-renderer/server-plugin'\r\nimport nodeExternals from 'webpack-node-externals'\r\nimport { each } from 'lodash'\r\nimport { resolve } from 'path'\r\nimport { existsSync } from 'fs'\r\nimport base from './base.config.js'\r\n\r\n/*\r\n|--------------------------------------------------------------------------\r\n| Webpack Server Config\r\n|--------------------------------------------------------------------------\r\n*/\r\nexport default function webpackServerConfig() {\r\n  let config = base.call(this, 'server')\r\n\r\n  // env object defined in nuxt.config.js\r\n  let env = {}\r\n  each(this.options.env, (value, key) => {\r\n    env['process.env.' + key] = (['boolean', 'number'].indexOf(typeof value) !== -1 ? value : JSON.stringify(value))\r\n  })\r\n\r\n  config = Object.assign(config, {\r\n    target: 'node',\r\n    node: false,\r\n    devtool: 'source-map',\r\n    entry: resolve(this.options.buildDir, 'server.js'),\r\n    output: Object.assign({}, config.output, {\r\n      filename: 'server-bundle.js',\r\n      libraryTarget: 'commonjs2'\r\n    }),\r\n    performance: {\r\n      hints: false,\r\n      maxAssetSize: Infinity\r\n    },\r\n    externals: [],\r\n    plugins: (config.plugins || []).concat([\r\n      new VueSSRServerPlugin({\r\n        filename: 'server-bundle.json'\r\n      }),\r\n      new webpack.DefinePlugin(Object.assign(env, {\r\n        'process.env.NODE_ENV': JSON.stringify(env.NODE_ENV || (this.options.dev ? 'development' : 'production')),\r\n        'process.env.VUE_ENV': JSON.stringify('server'),\r\n        'process.mode': JSON.stringify(this.options.mode),\r\n        'process.browser': false,\r\n        'process.client': false,\r\n        'process.server': true,\r\n        'process.static': this.isStatic\r\n      }))\r\n    ])\r\n  })\r\n\r\n  // https://webpack.js.org/configuration/externals/#externals\r\n  // https://github.com/liady/webpack-node-externals\r\n  this.options.modulesDir.forEach(dir => {\r\n    if (existsSync(dir)) {\r\n      config.externals.push(nodeExternals({\r\n        // load non-javascript files with extensions, presumably via loaders\r\n        whitelist: [/es6-promise|\\.(?!(?:js|json)$).{1,5}$/i],\r\n        modulesDir: dir\r\n      }))\r\n    }\r\n  })\r\n\r\n  // --------------------------------------\r\n  // Production specific config\r\n  // --------------------------------------\r\n  if (!this.options.dev) {\r\n\r\n  }\r\n\r\n  // Extend config\r\n  if (typeof this.options.build.extend === 'function') {\r\n    const isDev = this.options.dev\r\n    const extendedConfig = this.options.build.extend.call(this, config, {\r\n      get dev() {\r\n        console.warn('dev has been deprecated in build.extend(), please use isDev') // eslint-disable-line no-console\r\n        return isDev\r\n      },\r\n      isDev,\r\n      isServer: true\r\n    })\r\n    // Only overwrite config when something is returned for backwards compatibility\r\n    if (extendedConfig !== undefined) {\r\n      config = extendedConfig\r\n    }\r\n  }\r\n\r\n  return config\r\n}\r\n","import webpack from 'webpack'\r\nimport { resolve } from 'path'\r\nimport ClientConfig from './client.config'\r\n\r\n/*\r\n|--------------------------------------------------------------------------\r\n| Webpack Dll Config\r\n| https://github.com/webpack/webpack/tree/master/examples/dll\r\n|--------------------------------------------------------------------------\r\n*/\r\nexport default function webpackDllConfig(_refConfig) {\r\n  const refConfig = _refConfig || new ClientConfig()\r\n\r\n  const name = refConfig.name + '-dll'\r\n  const dllDir = resolve(this.options.cacheDir, name)\r\n\r\n  let config = {\r\n    name,\r\n    entry: this.vendorEntries(),\r\n    // context: this.options.rootDir,\r\n    resolve: refConfig.resolve,\r\n    target: refConfig.target,\r\n    resolveLoader: refConfig.resolveLoader,\r\n    module: refConfig.module,\r\n    plugins: []\r\n  }\r\n\r\n  config.output = {\r\n    path: dllDir,\r\n    filename: '[name]_[hash].js',\r\n    library: '[name]_[hash]'\r\n  }\r\n\r\n  config.plugins.push(\r\n    new webpack.DllPlugin({\r\n      // The path to the manifest file which maps between\r\n      // modules included in a bundle and the internal IDs\r\n      // within that bundle\r\n      path: resolve(dllDir, '[name]-manifest.json'),\r\n\r\n      name: '[name]_[hash]'\r\n    })\r\n  )\r\n\r\n  return config\r\n}\r\n","export default function vueLoader() {\r\n  // https://vue-loader.vuejs.org/en\r\n  const config = {\r\n    postcss: this.options.build.postcss,\r\n    extractCSS: !!this.options.build.extractCSS,\r\n    cssSourceMap: this.options.build.cssSourceMap,\r\n    preserveWhitespace: false,\r\n    loaders: {\r\n      'js': {\r\n        loader: 'babel-loader',\r\n        options: Object.assign({}, this.babelOptions)\r\n      },\r\n      // Note: do not nest the `postcss` option under `loaders`\r\n      'css': this.styleLoader('css', [], true),\r\n      'less': this.styleLoader('less', 'less-loader', true),\r\n      'scss': this.styleLoader('scss', 'sass-loader', true),\r\n      'sass': this.styleLoader('sass', {loader: 'sass-loader', options: { indentedSyntax: true }}, true),\r\n      'stylus': this.styleLoader('stylus', 'stylus-loader', true),\r\n      'styl': this.styleLoader('stylus', 'stylus-loader', true)\r\n    },\r\n    template: {\r\n      doctype: 'html' // For pug, see https://github.com/vuejs/vue-loader/issues/55\r\n    },\r\n    transformToRequire: {\r\n      video: 'src',\r\n      source: 'src',\r\n      object: 'src',\r\n      embed: 'src'\r\n    }\r\n  }\r\n\r\n  // Return the config\r\n  return config\r\n}\r\n","import ExtractTextPlugin from 'extract-text-webpack-plugin'\r\nimport { join } from 'path'\r\n\r\nexport default function styleLoader(ext, loaders = [], isVueLoader = false) {\r\n  // Normalize loaders\r\n  loaders = (Array.isArray(loaders) ? loaders : [loaders]).map(loader => {\r\n    if (typeof loader === 'string') {\r\n      loader = { loader }\r\n    }\r\n    return Object.assign({\r\n      options: {\r\n        sourceMap: this.options.build.cssSourceMap\r\n      }\r\n    }, loader)\r\n  })\r\n\r\n  // https://github.com/postcss/postcss-loader\r\n  let postcssLoader\r\n  if (!isVueLoader && this.options.build.postcss) {\r\n    postcssLoader = {\r\n      loader: 'postcss-loader',\r\n      options: this.options.build.postcss\r\n    }\r\n  }\r\n\r\n  // https://github.com/webpack-contrib/css-loader\r\n  const cssLoader = {\r\n    loader: 'css-loader',\r\n    options: {\r\n      minimize: true,\r\n      importLoaders: 1,\r\n      sourceMap: this.options.build.cssSourceMap,\r\n      alias: {\r\n        '/static': join(this.options.srcDir, 'static'),\r\n        '/assets': join(this.options.srcDir, 'assets')\r\n      }\r\n    }\r\n  }\r\n\r\n  // https://github.com/vuejs/vue-style-loader\r\n  const vueStyleLoader = {\r\n    loader: 'vue-style-loader',\r\n    options: {\r\n      sourceMap: this.options.build.cssSourceMap\r\n    }\r\n  }\r\n\r\n  if (this.options.build.extractCSS && !this.options.dev) {\r\n    return ExtractTextPlugin.extract({\r\n      fallback: vueStyleLoader,\r\n      use: [\r\n        cssLoader,\r\n        postcssLoader,\r\n        ...loaders\r\n      ].filter(l => l)\r\n    })\r\n  }\r\n\r\n  // https://github.com/yenshih/style-resources-loader\r\n  let styleResourcesLoader\r\n  if (this.options.build.styleResources) {\r\n    styleResourcesLoader = {\r\n      loader: 'style-resources-loader',\r\n      options: this.options.build.styleResources\r\n    }\r\n  }\r\n\r\n  return [\r\n    vueStyleLoader,\r\n    cssLoader,\r\n    postcssLoader,\r\n    ...loaders,\r\n    styleResourcesLoader\r\n  ].filter(l => l)\r\n}\r\n","import _ from 'lodash'\r\nimport chokidar from 'chokidar'\r\nimport fs, { remove, readFile, writeFile, mkdirp, existsSync } from 'fs-extra'\r\nimport hash from 'hash-sum'\r\nimport pify from 'pify'\r\nimport webpack from 'webpack'\r\nimport serialize from 'serialize-javascript'\r\nimport { join, resolve, basename, extname, dirname } from 'path'\r\nimport MFS from 'memory-fs'\r\nimport webpackDevMiddleware from 'webpack-dev-middleware'\r\nimport webpackHotMiddleware from 'webpack-hot-middleware'\r\nimport { r, wp, wChunk, createRoutes, sequence, relativeTo, isPureObject, waitFor } from 'utils'\r\nimport Debug from 'debug'\r\nimport Glob from 'glob'\r\nimport clientWebpackConfig from './webpack/client.config.js'\r\nimport serverWebpackConfig from './webpack/server.config.js'\r\nimport dllWebpackConfig from './webpack/dll.config.js'\r\nimport vueLoaderConfig from './webpack/vue-loader.config'\r\nimport styleLoader from './webpack/style-loader'\r\n\r\nconst debug = Debug('nuxt:build')\r\ndebug.color = 2 // Force green color\r\n\r\nconst glob = pify(Glob)\r\n\r\nexport default class Builder {\r\n  constructor(nuxt) {\r\n    this.nuxt = nuxt\r\n    this.isStatic = false // Flag to know if the build is for a generated app\r\n    this.options = nuxt.options\r\n\r\n    // Fields that set on build\r\n    this.compilers = []\r\n    this.compilersWatching = []\r\n    this.webpackDevMiddleware = null\r\n    this.webpackHotMiddleware = null\r\n    this.filesWatcher = null\r\n    this.customFilesWatcher = null\r\n\r\n    // Mute stats on dev\r\n    this.webpackStats = this.options.dev ? false : {\r\n      chunks: false,\r\n      children: false,\r\n      modules: false,\r\n      colors: true,\r\n      excludeAssets: [\r\n        /.map$/,\r\n        /index\\..+\\.html$/,\r\n        /vue-ssr-client-manifest.json/\r\n      ]\r\n    }\r\n\r\n    // Helper to resolve build paths\r\n    this.relativeToBuild = (...args) => relativeTo(this.options.buildDir, ...args)\r\n\r\n    // Bind styleLoader and vueLoader\r\n    this.styleLoader = styleLoader.bind(this)\r\n    this.vueLoader = vueLoaderConfig.bind(this)\r\n\r\n    this._buildStatus = STATUS.INITIAL\r\n\r\n    // Stop watching on nuxt.close()\r\n    if (this.options.dev) {\r\n      this.nuxt.hook('close', () => this.unwatch())\r\n    }\r\n  }\r\n\r\n  get plugins() {\r\n    return this.options.plugins.map((p, i) => {\r\n      if (typeof p === 'string') p = { src: p }\r\n      return {\r\n        src: this.nuxt.resolvePath(p.src),\r\n        ssr: (p.ssr !== false),\r\n        name: basename(p.src, extname(p.src)).replace(/[^a-zA-Z?\\d\\s:]/g, '') + '_plugin_' + hash(p.src)\r\n      }\r\n    })\r\n  }\r\n\r\n  vendor() {\r\n    return [\r\n      'vue',\r\n      'vue-router',\r\n      'vue-meta',\r\n      this.options.store && 'vuex'\r\n    ].concat(this.options.build.vendor).filter(v => v)\r\n  }\r\n\r\n  vendorEntries() {\r\n    // Used for dll\r\n    const vendor = this.vendor()\r\n    const vendorEntries = {}\r\n    vendor.forEach(v => {\r\n      try {\r\n        require.resolve(v)\r\n        vendorEntries[v] = [ v ]\r\n      } catch (e) {\r\n        // Ignore\r\n      }\r\n    })\r\n    return vendorEntries\r\n  }\r\n\r\n  forGenerate() {\r\n    this.isStatic = true\r\n  }\r\n\r\n  async build() {\r\n    // Avoid calling build() method multiple times when dev:true\r\n    /* istanbul ignore if */\r\n    if (this._buildStatus === STATUS.BUILD_DONE && this.options.dev) {\r\n      return this\r\n    }\r\n    // If building\r\n    /* istanbul ignore if */\r\n    if (this._buildStatus === STATUS.BUILDING) {\r\n      await waitFor(1000)\r\n      return this.build()\r\n    }\r\n    this._buildStatus = STATUS.BUILDING\r\n\r\n    // Wait for nuxt ready\r\n    await this.nuxt.ready()\r\n\r\n    // Call before hook\r\n    await this.nuxt.callHook('build:before', this, this.options.build)\r\n\r\n    // Babel options\r\n    this.babelOptions = _.defaults(this.options.build.babel, {\r\n      babelrc: false,\r\n      cacheDirectory: !!this.options.dev\r\n    })\r\n    if (!this.babelOptions.babelrc && !this.babelOptions.presets) {\r\n      this.babelOptions.presets = [\r\n        [require.resolve('babel-preset-vue-app'), {\r\n          targets: { ie: 9, uglify: true }\r\n        }]\r\n      ]\r\n    }\r\n\r\n    // Map postcss plugins into instances on object mode once\r\n    if (isPureObject(this.options.build.postcss)) {\r\n      if (isPureObject(this.options.build.postcss.plugins)) {\r\n        this.options.build.postcss.plugins = Object.keys(this.options.build.postcss.plugins)\r\n          .map(p => {\r\n            const plugin = require(this.nuxt.resolvePath(p))\r\n            const opts = this.options.build.postcss.plugins[p]\r\n            if (opts === false) return // Disabled\r\n            const instance = plugin(opts)\r\n            return instance\r\n          }).filter(e => e)\r\n      }\r\n    }\r\n\r\n    // Check if pages dir exists and warn if not\r\n    this._nuxtPages = typeof this.options.build.createRoutes !== 'function'\r\n    if (this._nuxtPages) {\r\n      if (!fs.existsSync(join(this.options.srcDir, 'pages'))) {\r\n        let dir = this.options.srcDir\r\n        if (fs.existsSync(join(this.options.srcDir, '..', 'pages'))) {\r\n          throw new Error(`No \\`pages\\` directory found in ${dir}. Did you mean to run \\`nuxt\\` in the parent (\\`../\\`) directory?`)\r\n        } else {\r\n          throw new Error(`Couldn't find a \\`pages\\` directory in ${dir}. Please create one under the project root`)\r\n        }\r\n      }\r\n    }\r\n\r\n    debug(`App root: ${this.options.srcDir}`)\r\n    debug(`Generating ${this.options.buildDir} files...`)\r\n\r\n    // Create .nuxt/, .nuxt/components and .nuxt/dist folders\r\n    await remove(r(this.options.buildDir))\r\n    await mkdirp(r(this.options.buildDir, 'components'))\r\n    if (!this.options.dev) {\r\n      await mkdirp(r(this.options.buildDir, 'dist'))\r\n    }\r\n\r\n    // Generate routes and interpret the template files\r\n    await this.generateRoutesAndFiles()\r\n\r\n    // Start webpack build\r\n    await this.webpackBuild()\r\n\r\n    // Flag to set that building is done\r\n    this._buildStatus = STATUS.BUILD_DONE\r\n\r\n    // Call done hook\r\n    await this.nuxt.callHook('build:done', this)\r\n\r\n    return this\r\n  }\r\n\r\n  async generateRoutesAndFiles() {\r\n    debug('Generating files...')\r\n    // -- Templates --\r\n    let templatesFiles = [\r\n      'App.js',\r\n      'client.js',\r\n      'index.js',\r\n      'middleware.js',\r\n      'router.js',\r\n      'server.js',\r\n      'utils.js',\r\n      'empty.js',\r\n      'components/nuxt-error.vue',\r\n      'components/nuxt-loading.vue',\r\n      'components/nuxt-child.js',\r\n      'components/nuxt-link.js',\r\n      'components/nuxt.js',\r\n      'components/no-ssr.js',\r\n      'views/app.template.html',\r\n      'views/error.html'\r\n    ]\r\n    const templateVars = {\r\n      options: this.options,\r\n      messages: this.options.messages,\r\n      uniqBy: _.uniqBy,\r\n      isDev: this.options.dev,\r\n      debug: this.options.debug,\r\n      mode: this.options.mode,\r\n      router: this.options.router,\r\n      env: this.options.env,\r\n      head: this.options.head,\r\n      middleware: fs.existsSync(join(this.options.srcDir, 'middleware')),\r\n      store: this.options.store,\r\n      css: this.options.css,\r\n      plugins: this.plugins,\r\n      appPath: './App.js',\r\n      layouts: Object.assign({}, this.options.layouts),\r\n      loading: typeof this.options.loading === 'string' ? this.relativeToBuild(this.options.srcDir, this.options.loading) : this.options.loading,\r\n      transition: this.options.transition,\r\n      layoutTransition: this.options.layoutTransition,\r\n      components: {\r\n        ErrorPage: this.options.ErrorPage ? this.relativeToBuild(this.options.ErrorPage) : null\r\n      }\r\n    }\r\n\r\n    // -- Layouts --\r\n    if (fs.existsSync(resolve(this.options.srcDir, 'layouts'))) {\r\n      const layoutsFiles = await glob('layouts/**/*.vue', { cwd: this.options.srcDir })\r\n      let hasErrorLayout = false\r\n      layoutsFiles.forEach((file) => {\r\n        let name = file.split('/').slice(1).join('/').replace(/\\.vue$/, '')\r\n        if (name === 'error') {\r\n          hasErrorLayout = true\r\n          return\r\n        }\r\n        templateVars.layouts[name] = this.relativeToBuild(this.options.srcDir, file)\r\n      })\r\n      if (!templateVars.components.ErrorPage && hasErrorLayout) {\r\n        templateVars.components.ErrorPage = this.relativeToBuild(this.options.srcDir, 'layouts/error.vue')\r\n      }\r\n    }\r\n    // If no default layout, create its folder and add the default folder\r\n    if (!templateVars.layouts.default) {\r\n      await mkdirp(r(this.options.buildDir, 'layouts'))\r\n      templatesFiles.push('layouts/default.vue')\r\n      templateVars.layouts.default = './layouts/default.vue'\r\n    }\r\n\r\n    // -- Routes --\r\n    debug('Generating routes...')\r\n    // If user defined a custom method to create routes\r\n    if (this._nuxtPages) {\r\n      // Use nuxt.js createRoutes bases on pages/\r\n      const files = await glob('pages/**/*.vue', { cwd: this.options.srcDir })\r\n      templateVars.router.routes = createRoutes(files, this.options.srcDir)\r\n    } else {\r\n      templateVars.router.routes = this.options.build.createRoutes(this.options.srcDir)\r\n    }\r\n\r\n    await this.nuxt.callHook('build:extendRoutes', templateVars.router.routes, r)\r\n\r\n    // router.extendRoutes method\r\n    if (typeof this.options.router.extendRoutes === 'function') {\r\n      // let the user extend the routes\r\n      const extendedRoutes = this.options.router.extendRoutes(templateVars.router.routes, r)\r\n      // Only overwrite routes when something is returned for backwards compatibility\r\n      if (extendedRoutes !== undefined) {\r\n        templateVars.router.routes = extendedRoutes\r\n      }\r\n    }\r\n\r\n    // Make routes accessible for other modules and webpack configs\r\n    this.routes = templateVars.router.routes\r\n\r\n    // -- Store --\r\n    // Add store if needed\r\n    if (this.options.store) {\r\n      templatesFiles.push('store.js')\r\n    }\r\n\r\n    // Resolve template files\r\n    const customTemplateFiles = this.options.build.templates.map(t => t.dst || basename(t.src || t))\r\n\r\n    templatesFiles = templatesFiles.map(file => {\r\n      // Skip if custom file was already provided in build.templates[]\r\n      if (customTemplateFiles.indexOf(file) !== -1) {\r\n        return\r\n      }\r\n      // Allow override templates using a file with same name in ${srcDir}/app\r\n      const customPath = r(this.options.srcDir, 'app', file)\r\n      const customFileExists = fs.existsSync(customPath)\r\n\r\n      return {\r\n        src: customFileExists\r\n          ? customPath\r\n          : r(this.options.nuxtAppDir, file),\r\n        dst: file,\r\n        custom: customFileExists\r\n      }\r\n    }).filter(i => !!i)\r\n\r\n    // -- Custom templates --\r\n    // Add custom template files\r\n    templatesFiles = templatesFiles.concat(this.options.build.templates.map(t => {\r\n      return Object.assign({\r\n        src: r(this.options.srcDir, t.src || t),\r\n        dst: t.dst || basename(t.src || t),\r\n        custom: true\r\n      }, t)\r\n    }))\r\n\r\n    // -- Loading indicator --\r\n    if (this.options.loadingIndicator.name) {\r\n      const indicatorPath1 = resolve(this.options.nuxtAppDir, 'views/loading', this.options.loadingIndicator.name + '.html')\r\n      const indicatorPath2 = this.nuxt.resolvePath(this.options.loadingIndicator.name)\r\n      const indicatorPath = existsSync(indicatorPath1) ? indicatorPath1 : (existsSync(indicatorPath2) ? indicatorPath2 : null)\r\n      if (indicatorPath) {\r\n        templatesFiles.push({\r\n          src: indicatorPath,\r\n          dst: 'loading.html',\r\n          options: this.options.loadingIndicator\r\n        })\r\n      } else {\r\n        /* istanbul ignore next */\r\n        console.error(`Could not fetch loading indicator: ${this.options.loadingIndicator.name}`) // eslint-disable-line no-console\r\n      }\r\n    }\r\n\r\n    await this.nuxt.callHook('build:templates', { templatesFiles, templateVars, resolve: r })\r\n\r\n    // Interpret and move template files to .nuxt/\r\n    await Promise.all(templatesFiles.map(async ({ src, dst, options, custom }) => {\r\n      // Add template to watchers\r\n      this.options.build.watch.push(src)\r\n      // Render template to dst\r\n      const fileContent = await readFile(src, 'utf8')\r\n      let content\r\n      try {\r\n        const template = _.template(fileContent, {\r\n          imports: {\r\n            serialize,\r\n            hash,\r\n            r,\r\n            wp,\r\n            wChunk,\r\n            resolvePath: this.nuxt.resolvePath.bind(this.nuxt),\r\n            relativeToBuild: this.relativeToBuild\r\n          }\r\n        })\r\n        content = template(Object.assign({}, templateVars, {\r\n          options: options || {},\r\n          custom,\r\n          src,\r\n          dst\r\n        }))\r\n      } catch (err) {\r\n        /* istanbul ignore next */\r\n        throw new Error(`Could not compile template ${src}: ${err.message}`)\r\n      }\r\n      const path = r(this.options.buildDir, dst)\r\n      // Ensure parent dir exits\r\n      await mkdirp(dirname(path))\r\n      // Write file\r\n      await writeFile(path, content, 'utf8')\r\n    }))\r\n  }\r\n\r\n  async webpackBuild() {\r\n    debug('Building files...')\r\n    const compilersOptions = []\r\n\r\n    // Client\r\n    const clientConfig = clientWebpackConfig.call(this)\r\n    compilersOptions.push(clientConfig)\r\n\r\n    // Server\r\n    let serverConfig = null\r\n    if (this.options.build.ssr) {\r\n      serverConfig = serverWebpackConfig.call(this)\r\n      compilersOptions.push(serverConfig)\r\n    }\r\n\r\n    // Alias plugins to their real path\r\n    this.plugins.forEach(p => {\r\n      const src = this.relativeToBuild(p.src)\r\n\r\n      // Client config\r\n      if (!clientConfig.resolve.alias[p.name]) {\r\n        clientConfig.resolve.alias[p.name] = src\r\n      }\r\n\r\n      // Server config\r\n      if (serverConfig && !serverConfig.resolve.alias[p.name]) {\r\n        // Alias to noop for ssr:false plugins\r\n        serverConfig.resolve.alias[p.name] = p.ssr ? src : './empty.js'\r\n      }\r\n    })\r\n\r\n    // Make a dll plugin after compile to make nuxt dev builds faster\r\n    if (this.options.build.dll && this.options.dev) {\r\n      compilersOptions.push(dllWebpackConfig.call(this, clientConfig))\r\n    }\r\n\r\n    // Initialize shared FS and Cache\r\n    const sharedFS = this.options.dev && new MFS()\r\n    const sharedCache = {}\r\n\r\n    // Initialize compilers\r\n    this.compilers = compilersOptions.map(compilersOption => {\r\n      const compiler = webpack(compilersOption)\r\n      // In dev, write files in memory FS (except for DLL)\r\n      if (sharedFS && !compiler.name.includes('-dll')) {\r\n        compiler.outputFileSystem = sharedFS\r\n      }\r\n      compiler.cache = sharedCache\r\n      return compiler\r\n    })\r\n\r\n    // Start Builds\r\n    await sequence(this.compilers, (compiler) => new Promise(async (resolve, reject) => {\r\n      const name = compiler.options.name\r\n      await this.nuxt.callHook('build:compile', { name, compiler })\r\n\r\n      // Resolve only when compiler emit done event\r\n      compiler.plugin('done', async (stats) => {\r\n        await this.nuxt.callHook('build:compiled', { name, compiler, stats })\r\n        // Reload renderer if available\r\n        this.nuxt.renderer.loadResources(sharedFS || fs)\r\n        // Resolve on next tick\r\n        process.nextTick(resolve)\r\n      })\r\n      // --- Dev Build ---\r\n      if (this.options.dev) {\r\n        // Client Build, watch is started by dev-middleware\r\n        if (compiler.options.name === 'client') {\r\n          return this.webpackDev(compiler)\r\n        }\r\n        // DLL build, should run only once\r\n        if (compiler.options.name.includes('-dll')) {\r\n          compiler.run((err, stats) => {\r\n            if (err) return reject(err)\r\n            debug('[DLL] updated')\r\n          })\r\n          return\r\n        }\r\n        // Server, build and watch for changes\r\n        this.compilersWatching.push(\r\n          compiler.watch(this.options.watchers.webpack, (err) => {\r\n            /* istanbul ignore if */\r\n            if (err) return reject(err)\r\n          })\r\n        )\r\n        return\r\n      }\r\n      // --- Production Build ---\r\n      compiler.run((err, stats) => {\r\n        /* istanbul ignore if */\r\n        if (err) {\r\n          console.error(err) // eslint-disable-line no-console\r\n          return reject(err)\r\n        }\r\n\r\n        // Show build stats for production\r\n        console.log(stats.toString(this.webpackStats)) // eslint-disable-line no-console\r\n\r\n        /* istanbul ignore if */\r\n        if (stats.hasErrors()) {\r\n          return reject(new Error('Webpack build exited with errors'))\r\n        }\r\n      })\r\n    }))\r\n  }\r\n\r\n  webpackDev(compiler) {\r\n    debug('Adding webpack middleware...')\r\n\r\n    // Create webpack dev middleware\r\n    this.webpackDevMiddleware = pify(webpackDevMiddleware(compiler, Object.assign({\r\n      publicPath: this.options.build.publicPath,\r\n      stats: this.webpackStats,\r\n      noInfo: true,\r\n      quiet: true,\r\n      watchOptions: this.options.watchers.webpack\r\n    }, this.options.build.devMiddleware)))\r\n\r\n    this.webpackDevMiddleware.close = pify(this.webpackDevMiddleware.close)\r\n\r\n    this.webpackHotMiddleware = pify(webpackHotMiddleware(compiler, Object.assign({\r\n      log: false,\r\n      heartbeat: 10000\r\n    }, this.options.build.hotMiddleware)))\r\n\r\n    // Inject to renderer instance\r\n    if (this.nuxt.renderer) {\r\n      this.nuxt.renderer.webpackDevMiddleware = this.webpackDevMiddleware\r\n      this.nuxt.renderer.webpackHotMiddleware = this.webpackHotMiddleware\r\n    }\r\n\r\n    // Start watching files\r\n    this.watchFiles()\r\n  }\r\n\r\n  watchFiles() {\r\n    const src = this.options.srcDir\r\n    const patterns = [\r\n      r(src, 'layouts'),\r\n      r(src, 'store'),\r\n      r(src, 'middleware'),\r\n      r(src, 'layouts/*.vue'),\r\n      r(src, 'layouts/**/*.vue')\r\n    ]\r\n    if (this._nuxtPages) {\r\n      patterns.push(\r\n        r(src, 'pages'),\r\n        r(src, 'pages/*.vue'),\r\n        r(src, 'pages/**/*.vue')\r\n      )\r\n    }\r\n    const options = Object.assign({}, this.options.watchers.chokidar, {\r\n      ignoreInitial: true\r\n    })\r\n    /* istanbul ignore next */\r\n    const refreshFiles = _.debounce(() => this.generateRoutesAndFiles(), 200)\r\n\r\n    // Watch for src Files\r\n    this.filesWatcher = chokidar.watch(patterns, options)\r\n      .on('add', refreshFiles)\r\n      .on('unlink', refreshFiles)\r\n\r\n    // Watch for custom provided files\r\n    this.customFilesWatcher = chokidar.watch(_.uniq(this.options.build.watch), options)\r\n      .on('change', refreshFiles)\r\n  }\r\n\r\n  async unwatch() {\r\n    if (this.filesWatcher) {\r\n      this.filesWatcher.close()\r\n    }\r\n\r\n    if (this.customFilesWatcher) {\r\n      this.customFilesWatcher.close()\r\n    }\r\n\r\n    this.compilersWatching.forEach(watching => watching.close())\r\n\r\n    // Stop webpack middleware\r\n    await this.webpackDevMiddleware.close()\r\n  }\r\n}\r\n\r\nconst STATUS = {\r\n  INITIAL: 1,\r\n  BUILD_DONE: 2,\r\n  BUILDING: 3\r\n}\r\n","import { copy, remove, writeFile, mkdirp, removeSync, existsSync } from 'fs-extra'\r\nimport _ from 'lodash'\r\nimport { resolve, join, dirname, sep } from 'path'\r\nimport { minify } from 'html-minifier'\r\nimport { isUrl, promisifyRoute, waitFor, flatRoutes } from 'utils'\r\n\r\nexport default class Generator {\r\n  constructor(nuxt, builder) {\r\n    this.nuxt = nuxt\r\n    this.options = nuxt.options\r\n    this.builder = builder\r\n\r\n    // Set variables\r\n    this.staticRoutes = resolve(this.options.srcDir, 'static')\r\n    this.srcBuiltPath = resolve(this.options.buildDir, 'dist')\r\n    this.distPath = resolve(this.options.rootDir, this.options.generate.dir)\r\n    this.distNuxtPath = join(this.distPath, (isUrl(this.options.build.publicPath) ? '' : this.options.build.publicPath))\r\n  }\r\n\r\n  async generate({ build = true, init = true } = {}) {\r\n    await this.initiate({ build, init })\r\n\r\n    const routes = await this.initRoutes()\r\n\r\n    const errors = await this.generateRoutes(routes)\r\n    await this.afterGenerate()\r\n\r\n    // done hook\r\n    await this.nuxt.callHook('generate:done', this, errors)\r\n\r\n    return { errors }\r\n  }\r\n\r\n  async initiate({ build = true, init = true } = {}) {\r\n    // Wait for nuxt be ready\r\n    await this.nuxt.ready()\r\n\r\n    // Call before hook\r\n    await this.nuxt.callHook('generate:before', this, this.options.generate)\r\n\r\n    // Add flag to set process.static\r\n    this.builder.forGenerate()\r\n\r\n    // Start build process\r\n    if (build) {\r\n      await this.builder.build()\r\n    }\r\n\r\n    // Initialize dist directory\r\n    if (init) {\r\n      await this.initDist()\r\n    }\r\n  }\r\n\r\n  async initRoutes() {\r\n    // Resolve config.generate.routes promises before generating the routes\r\n    let generateRoutes = []\r\n    if (this.options.router.mode !== 'hash') {\r\n      try {\r\n        generateRoutes = await promisifyRoute(this.options.generate.routes || [])\r\n      } catch (e) {\r\n        console.error('Could not resolve routes') // eslint-disable-line no-console\r\n        throw e // eslint-disable-line no-unreachable\r\n      }\r\n    }\r\n\r\n    // Generate only index.html for router.mode = 'hash'\r\n    let routes = (this.options.router.mode === 'hash') ? ['/'] : flatRoutes(this.options.router.routes)\r\n    routes = this.decorateWithPayloads(routes, generateRoutes)\r\n\r\n    // extendRoutes hook\r\n    await this.nuxt.callHook('generate:extendRoutes', routes)\r\n\r\n    return routes\r\n  }\r\n\r\n  async generateRoutes(routes) {\r\n    let errors = []\r\n\r\n    // Start generate process\r\n    while (routes.length) {\r\n      let n = 0\r\n      await Promise.all(routes.splice(0, this.options.generate.concurrency).map(async ({ route, payload }) => {\r\n        await waitFor(n++ * this.options.generate.interval)\r\n        await this.generateRoute({ route, payload, errors })\r\n      }))\r\n    }\r\n\r\n    return errors\r\n  }\r\n\r\n  async afterGenerate() {\r\n    const indexPath = join(this.distPath, 'index.html')\r\n    if (existsSync(indexPath)) {\r\n      // Copy /index.html to /200.html for surge SPA\r\n      // https://surge.sh/help/adding-a-200-page-for-client-side-routing\r\n      const _200Path = join(this.distPath, '200.html')\r\n      if (!existsSync(_200Path)) {\r\n        await copy(indexPath, _200Path)\r\n      }\r\n    }\r\n  }\r\n\r\n  async initDist() {\r\n    // Clean destination folder\r\n    await remove(this.distPath)\r\n\r\n    await this.nuxt.callHook('generate:distRemoved', this)\r\n\r\n    // Copy static and built files\r\n    /* istanbul ignore if */\r\n    if (existsSync(this.staticRoutes)) {\r\n      await copy(this.staticRoutes, this.distPath)\r\n    }\r\n    await copy(this.srcBuiltPath, this.distNuxtPath)\r\n\r\n    // Add .nojekyll file to let Github Pages add the _nuxt/ folder\r\n    // https://help.github.com/articles/files-that-start-with-an-underscore-are-missing/\r\n    const nojekyllPath = resolve(this.distPath, '.nojekyll')\r\n    writeFile(nojekyllPath, '')\r\n\r\n    // Cleanup SSR related files\r\n    const extraFiles = [\r\n      'index.spa.html',\r\n      'index.ssr.html',\r\n      'server-bundle.json',\r\n      'vue-ssr-client-manifest.json'\r\n    ].map(file => resolve(this.distNuxtPath, file))\r\n\r\n    extraFiles.forEach(file => {\r\n      if (existsSync(file)) {\r\n        removeSync(file)\r\n      }\r\n    })\r\n\r\n    await this.nuxt.callHook('generate:distCopied', this)\r\n  }\r\n\r\n  decorateWithPayloads(routes, generateRoutes) {\r\n    let routeMap = {}\r\n    // Fill routeMap for known routes\r\n    routes.forEach((route) => {\r\n      routeMap[route] = {\r\n        route,\r\n        payload: null\r\n      }\r\n    })\r\n    // Fill routeMap with given generate.routes\r\n    generateRoutes.forEach((route) => {\r\n      // route is either a string or like { route : '/my_route/1', payload: {} }\r\n      const path = _.isString(route) ? route : route.route\r\n      routeMap[path] = {\r\n        route: path,\r\n        payload: route.payload || null\r\n      }\r\n    })\r\n    return _.values(routeMap)\r\n  }\r\n\r\n  async generateRoute({ route, payload = {}, errors = [] }) {\r\n    let html\r\n    const pageErrors = []\r\n\r\n    try {\r\n      const res = await this.nuxt.renderer.renderRoute(route, { _generate: true, payload })\r\n      html = res.html\r\n      if (res.error) {\r\n        pageErrors.push({ type: 'handled', route, error: res.error })\r\n      }\r\n    } catch (err) {\r\n      /* istanbul ignore next */\r\n      pageErrors.push({ type: 'unhandled', route, error: err })\r\n      Array.prototype.push.apply(errors, pageErrors)\r\n\r\n      await this.nuxt.callHook('generate:routeFailed', { route, errors: pageErrors })\r\n\r\n      return false\r\n    }\r\n\r\n    if (this.options.generate.minify) {\r\n      try {\r\n        html = minify(html, this.options.generate.minify)\r\n      } catch (err) /* istanbul ignore next */ {\r\n        const minifyErr = new Error(`HTML minification failed. Make sure the route generates valid HTML. Failed HTML:\\n ${html}`)\r\n        pageErrors.push({ type: 'unhandled', route, error: minifyErr })\r\n      }\r\n    }\r\n\r\n    let path\r\n\r\n    if (this.options.generate.subFolders) {\r\n      path = join(route, sep, 'index.html') // /about -> /about/index.html\r\n      path = path === '/404/index.html' ? '/404.html' : path // /404 -> /404.html\r\n    } else {\r\n      path =\r\n        route.length > 1 ? join(sep, route + '.html') : join(sep, 'index.html')\r\n    }\r\n\r\n    // Call hook to let user update the path & html\r\n    const page = { route, path, html }\r\n    await this.nuxt.callHook('generate:page', page)\r\n\r\n    page.path = join(this.distPath, page.path)\r\n\r\n    // Make sure the sub folders are created\r\n    await mkdirp(dirname(page.path))\r\n    await writeFile(page.path, page.html, 'utf8')\r\n\r\n    await this.nuxt.callHook('generate:routeCreated', { route, path: page.path, errors: pageErrors })\r\n\r\n    if (pageErrors.length) {\r\n      Array.prototype.push.apply(errors, pageErrors)\r\n    }\r\n\r\n    return true\r\n  }\r\n}\r\n","import * as core from './core'\r\nimport * as builder from './builder'\r\n\r\nexport default Object.assign({}, core, builder)\r\n"],"names":["encodeHtml","str","replace","getContext","req","res","setAnsiColors","ansiHTML","setColors","ms","Promise","setTimeout","resolve","waitFor","urlJoin","slice","call","arguments","join","isUrl","url","indexOf","promisifyRoute","fn","Array","isArray","length","reject","err","routeParams","promise","then","sequence","tasks","reduce","task","parallel","all","map","chainFn","base","Function","apply","baseResult","undefined","fnResult","prototype","isPureObject","o","isWindows","test","process","platform","wp","p","wChunk","reqSep","sysSep","_","escapeRegExp","sep","normalize","string","r","args","lastArg","last","includes","relativeTo","dir","shift","path","rp","relative","flatRoutes","router","routes","forEach","children","push","cleanChildrenRoutes","isChild","start","routesIndex","route","name","split","s","names","paths","i","a","find","child","createRoutes","files","srcDir","file","keys","component","parent","key","chunkName","sort","b","y","z","_a","_b","debug","Debug","color","Options","from","_options","options","Object","assign","loading","middleware","_routerBaseSpecified","transition","layoutTransition","defaultsDeep","defaults","hasValue","v","rootDir","cwd","buildDir","cacheDir","modulesDir","filter","appTemplatePath","existsSync","dev","build","publicPath","store","loadingIndicator","cssSourceMap","postcss","postcssConfigPath","plugins","modePreset","modes","mode","render","ssr","appear","env","NODE_ENV","__dirname","ModuleContainer","nuxt","requiredModules","callHook","modules","addModule","bind","vendor","uniq","concat","template","src","srcPath","parse","fs","dst","fileName","basename","hash","ext","templateObj","templates","addTemplate","unshift","serverMiddleware","extend","extendRoutes","moduleOpts","requireOnce","module","require","resolvePath","Error","JSON","stringify","meta","alreadyRequired","result","MetaRenderer","renderer","vueRenderer","VueServerRenderer","createRenderer","cache","LRU","use","VueMeta","vm","Vue","h","head","renderToString","$meta","inject","get","m","getMeta","HTML_ATTRS","htmlAttrs","text","BODY_ATTRS","bodyAttrs","HEAD","title","link","style","script","noscript","BODY_SCRIPTS","body","resourceHints","clientManifest","resources","initial","async","set","jsdom","Renderer","bundleRenderer","metaRenderer","webpackDevMiddleware","webpackHotMiddleware","app","connect","parseTemplate","setupMiddleware","loadResources","_fs","distPath","updated","transform","rawKey","rawData","data","readFileSync","errorTemplatePath","errorTemplate","loadingHTMLPath","loadingHTML","noSSR","isReady","Boolean","spaTemplate","ssrTemplate","isResourcesAvailable","serverBundle","createBundleRenderer","$m","handler","prefix","$src","gzip","useMiddleware","compression","next","ssrResourceRegex","statusCode","end","_this","openInEditor","editor","configure","query","q","part","decodeURIComponent","log","open","catch","serveStatic","static","distDir","nuxtMiddleware","errorMiddleware","context","renderRoute","html","error","redirected","etag","generateETag","fresh","headers","setHeader","http2","regex","pushAssets","exec","rel","href","as","Buffer","byteLength","message","sendResponse","content","type","statusMessage","hasReqHeader","header","toLowerCase","isJson","json","youch","Youch","readSource","toJSON","toHTML","frame","sanitizeName","maps","$maps","smc","SourceMapConsumer","line","column","source","originalPositionFor","getLineNumber","getColumnNumber","LEAST_UPPER_BOUND","lineNumber","columnNumber","functionName","contents","sourceContentFor","searchPath","pathDir","fullPath","readFile","spa","ENV","APP","messages","error_404","serverRendered","renderResourceHints","serialize","isJSON","renderScripts","renderStyles","opts","e","window","scrollTo","virtualConsole","VirtualConsole","sendTo","console","JSDOM","fromURL","nuxtExists","document","innerHTML","_onNuxtLoaded","templateStr","resourceMap","RegExp","resource","Nuxt","nodeModulePaths","Module","_nodeModulePaths","nuxtDir","initialized","errorHandler","_hooks","hook","moduleContainer","renderAndGetWindow","_ready","ready","isPlainObject","hooks","addObjectHooks","hookMap","hooksObj","port","host","server","listen","exclusive","_host","chalk","bgGreen","black","green","destroy","resolvedPath","_resolveFilename","substr","callback","TimeFixPlugin","timefix","compiler","plugin","watching","startTime","stats","webpackBaseConfig","nodeModulesDir","config","filenames","chunk","vueLoader","babelOptions","styleLoader","loader","indentedSyntax","extractCSS","extractOptions","filename","css","ExtractTextPlugin","compilation","warnings","warn","webpack","LoaderOptionsPlugin","cloneDeep","webpackClientConfig","entry","value","HTMLPlugin","VueSSRClientPlugin","optimize","CommonsChunkPlugin","Infinity","manifest","DefinePlugin","isStatic","ProgressBarPlugin","FriendlyErrorsWebpackPlugin","NamedModulesPlugin","HotModuleReplacementPlugin","NoEmitOnErrorsPlugin","dll","scopeHoisting","ModuleConcatenationPlugin","HashedModuleIdsPlugin","uglify","UglifyJSPlugin","analyze","BundleAnalyzerPlugin","isDev","extendedConfig","commonChunksPlugin","totalPages","maybeVendor","count","some","request","dllPlugin","_dlls","vendorEntries","dllDir","dllManifestFile","DllReferencePlugin","webpackServerConfig","output","VueSSRServerPlugin","externals","nodeExternals","webpackDllConfig","_refConfig","refConfig","ClientConfig","target","resolveLoader","DllPlugin","loaders","isVueLoader","postcssLoader","cssLoader","vueStyleLoader","extract","l","styleResourcesLoader","styleResources","glob","pify","Glob","Builder","compilers","compilersWatching","filesWatcher","customFilesWatcher","webpackStats","relativeToBuild","vueLoaderConfig","_buildStatus","STATUS","INITIAL","unwatch","extname","BUILD_DONE","BUILDING","babel","babelrc","presets","ie","instance","_nuxtPages","remove","mkdirp","generateRoutesAndFiles","webpackBuild","templatesFiles","templateVars","uniqBy","layouts","ErrorPage","layoutsFiles","hasErrorLayout","components","default","extendedRoutes","customTemplateFiles","t","customPath","customFileExists","nuxtAppDir","indicatorPath1","indicatorPath2","indicatorPath","custom","watch","fileContent","dirname","writeFile","compilersOptions","clientConfig","clientWebpackConfig","serverConfig","serverWebpackConfig","alias","dllWebpackConfig","sharedFS","MFS","sharedCache","compilersOption","outputFileSystem","nextTick","webpackDev","run","watchers","toString","hasErrors","devMiddleware","close","hotMiddleware","watchFiles","patterns","chokidar","refreshFiles","debounce","on","Generator","builder","staticRoutes","srcBuiltPath","generate","distNuxtPath","init","initiate","initRoutes","errors","generateRoutes","afterGenerate","forGenerate","initDist","decorateWithPayloads","n","splice","concurrency","payload","interval","generateRoute","indexPath","_200Path","copy","nojekyllPath","extraFiles","routeMap","isString","values","pageErrors","_generate","minify","minifyErr","subFolders","page","core"],"mappings":"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"}